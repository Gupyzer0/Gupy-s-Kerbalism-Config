// ============================================================================
// Radio And Plasma Wave Science
// ============================================================================

// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_EXPERIMENT_VALUES:NEEDS[FeatureScience]
{
	%SPACELINES
	{
        Spacelines_RPWS1
        {
            ECCost = 0.02
			size = 7
			value = 7
			duration = 302400 // 7 days 				
			requirements = 
			ResourceRates =
			CrewRequirement = 
            SetupCost = 
            mass = 
            tech = science5
        }
        Spacelines_RPWS2
        {
            ECCost = 0.05
			size = 100
			value = 20								
			duration = 1296000 // 1 month 				
			requirements = 
			ResourceRates =
			CrewRequirement = 
            SetupCost = 
            mass = 
            tech = science6
        }
        Spacelines_RPWS3
        {
            ECCost = 0.075
			size = 1700
			value = 14								
			duration = 7776000 // 6 months 				
			requirements = 
			ResourceRates =
			CrewRequirement = 
            SetupCost = 
            mass = 
            tech = science9
        }
    }
}

// ----------------------------------------------------------------------------
// Science Definitions 
// ----------------------------------------------------------------------------

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_RPWS1
    title = Radio Plasma Wave Science 1
    scienceCap = 7
    baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RPWS1/value$
	dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RPWS1/size$
	@dataScale /= #$baseValue$
    situationMask = 49

	RESULTS
    {
        default = Detailed recordings are made of local interactions with the solar plasma.
		default = Localized distortions in the flow of the solar wind are monitored.
    }

    KERBALISM_EXPERIMENT
    {
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0
		IncludeExperiment = 
    }
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_RPWS2
    title = Radio Plasma Wave Science 2
    scienceCap = 20
    baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RPWS2/value$
	dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RPWS2/size$
	@dataScale /= #$baseValue$
    situationMask = 49

	RESULTS
    {
        default = Detailed recordings are made of local interactions with the solar plasma.
		default = Localized distortions in the flow of the solar wind are monitored.
    }

    KERBALISM_EXPERIMENT
    {
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0
		IncludeExperiment = Spacelines_RPWS1
    }
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_RPWS3
    title = Radio Plasma Wave Science 3
    scienceCap = 30
    baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RPWS3/value$
	dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RPWS3/size$
	@dataScale /= #$baseValue$
    situationMask = 49

	RESULTS
    {
        default = Detailed recordings are made of local interactions with the solar plasma.
		default = Localized distortions in the flow of the solar wind are monitored.
    }

    KERBALISM_EXPERIMENT
    {
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0
		IncludeExperiment = Spacelines_RPWS1
    }
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------
// Modules being replaced:
// -----------------------
// + rpwsScan
// + bd_rpws
// ----------------------------------------------------------------------------

// Tagging parts
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[rpwsScan]]]:NEEDS[FeatureScience]
{
    %Tag_Spacelines_RPWS = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_rpws]]]:NEEDS[FeatureScience]
{
    %Tag_Spacelines_RPWS = True
}

// Configure Module
@PART[*]:HAS[#Tag_Spacelines_RPWS[True]]:NEEDS[FeatureScience]
{
    MODULE
    {
        name = Experiment
        experiment_id = Spacelines_RPWS1
        data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RPWS1/size$
        @data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RPWS1/duration$
        ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RPWS1/ec_rate$
        allow_shrouded = False
        sample_amount = 0
    }

    MODULE
    {
        name = Experiment
        experiment_id = Spacelines_RPWS2
        data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RPWS2/size$
        @data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RPWS2/duration$
        ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RPWS2/ec_rate$
        allow_shrouded = False
        sample_amount = 0
    }

    MODULE
    {
        name = Experiment
        experiment_id = Spacelines_RPWS3
        data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RPWS3/size$
        @data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RPWS3/duration$
        ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RPWS3/ec_rate$
        allow_shrouded = False
        sample_amount = 0
    }

    MODULE
	{
		name = Configure
		title = RPWS Experiments
		slots = 1

        SETUP
        {
            name = RPWS1
            desc = The Radio and Plasma Wave Science, or RPWS, instrument detects radio and plasma waves, as well as the plasma medium through which a space probe passes.

            MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_RPWS1
			}
        }

        SETUP
        {
            name = RPWS2
            desc = RPWS instrument similar to those in the Helios satellites

            MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_RPWS2
			}
        }

        SETUP
        {
            name = RPWS3
            desc = RPWS instrument similar to those in the Cassini probe

            MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_RPWS3
			}
        }
    }
}

// Experiment Values
@PART[*]:HAS[@MODULE[Configure]:HAS[#title[RPWS?Experiments]]]:NEEDS[FeatureScience]
{
	@MODULE[Configure]:HAS[#title[RPWS?Experiments]]
	{
		@SETUP:HAS[#name[RPWS1]]
		{
            cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS1/SetupCost
            mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS1/SetupMass
            tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS1/UnlockTech
        }
        @SETUP:HAS[#name[RPWS2]]
		{
            cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS2/SetupCost
            mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS2/SetupMass
            tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS2/UnlockTech
        }
        @SETUP:HAS[#name[RPWS3]]
		{
            cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS3/SetupCost
            mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS3/SetupMass
            tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS3/UnlockTech
        }
    }

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_RPWS1]]
	{
        %ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS1/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS1/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS1/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS1/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS1/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS1/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS1/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS1/size$
    }

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_RPWS2]]
	{
        %ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS2/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS2/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS2/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS2/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS2/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS2/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS2/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS2/size$
    }

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_RPWS3]]
	{
        %ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS3/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS3/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS3/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS3/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS3/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS3/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS3/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RPWS3/size$
    }
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[Configure]:HAS[#title[RPWS?Experiments]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment]
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

// ----------------------------------------------------------------------------
// Cleaning old science modules
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[rpwsScan]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[rpwsScan]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_rpws]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_rpws]] {}
}
