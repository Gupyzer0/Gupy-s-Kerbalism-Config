// ============================================================================
// Surface Sample Experiments
// ============================================================================

// ----------------------------------------------------------------------------
// Science Definitions 
// ----------------------------------------------------------------------------
EXPERIMENT_DEFINITION
{
    id = Spacelines_surfaceAnalysis1
	baseValue = 6
	scienceCap = 6
	dataScale = 0.1
    requireAtmosphere = False
    situationMask = 1
    biomeMask = 1
	
	RESULTS
	{
		default = Securing the top layer of soil and rocks for our geologists to study.
	}
	
	KERBALISM_EXPERIMENT
  	{
		SampleMass = 0.00008 // 80g
        Situation = Surface@Biomes
  	}
}

EXPERIMENT_DEFINITION
{
	id = Spacelines_surfaceAnalysis2
	title = Core Sample Drill
	scienceCap = 15
	baseValue = 15
	dataScale = 50
    requireAtmosphere = False
    situationMask = 1
    biomeMask = 1
   
	RESULTS
	{
		default = The drill bores down into the ground, and a core sample is extracted.
		default = A core sample of bedrock is extracted from beneath the loose surface.
	}

    KERBALISM_EXPERIMENT
	{
		SampleMass = 0.03
		Situation = Surface@Biomes
        IncludeExperiment = Spacelines_surfaceAnalysis1
	}
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------
// Experiments being replaced:
// ---------------------------
// + bd_soilScoop -> Spacelines_surfaceAnalysis1
// + bd_drill     -> Spacelines_surfaceAnalysis2
// ----------------------------------------------------------------------------

// Creating experiment module on the modules with the experiments being replaced
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_soilScoop]]]:NEEDS[FeatureScience] {
    MODULE
    {
        name = Experiment
        experiment_id = Spacelines_surfaceAnalysis1
    }
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_drill]]]:NEEDS[FeatureScience] {
    MODULE
    {
        name = Experiment
        experiment_id = Spacelines_surfaceAnalysis2
    }
}

// ----------------------------------------------------------------------------
// Reconfiguration
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[Experiment]:HAS[#experiment_id[Spacelines_surfaceAnalysis1]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_surfaceAnalysis1]] {
        %sample_collecting = True
		%sample_amount = 1
		%ec_rate = 0.02
		%data_rate = 0.1
		@data_rate /= 300 //5 minutes
		%requires = 
		%resources = 
		%hide_when_unavailable = true
    }
}

@PART[*]:HAS[@MODULE[Experiment]:HAS[#experiment_id[Spacelines_surfaceAnalysis2]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_surfaceAnalysis2]] {
        data_rate = 34
        @data_rate /= 10 // 10 secs
        ec_rate = 5
        allow_shrouded = false
        sample_collecting = True
        sample_amount = 1
    }
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------
// If there's an experiment with a DMOS module take their animations and insert them
// into the previously created Experiment module
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_soilScoop]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_surfaceAnalysis1]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_soilScoop]]/animationName$
    }
}

@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_drill]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_surfaceAnalysis2]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_drill]]/animationName$
    }
}

// ----------------------------------------------------------------------------
// Cleaning replaced experiments
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_soilScoop]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_soilScoop]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_drill]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_drill]] {}
}
