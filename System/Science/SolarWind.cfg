// ============================================================================
// Solar Wind
// ============================================================================
// Modules being replaced:
// -----------------------
// + bd_solarwind
// + dmSolarParticles
// ----------------------------------------------------------------------------

// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_EXPERIMENT_VALUES:NEEDS[FeatureScience]
{
	%SPACELINES
	{
        Spacelines_SolarWinnd
        {
            ECCost = 0.05	
            size = 11000
            value = 300
            SetupMass =
            SetupCost =			
            duration = 31536000 // 1y
            UnlockTech = 
            requirements =
            ResourceRates =
            CrewRequirement =
        }
    }
}

// ----------------------------------------------------------------------------
// Science Definitions 
// ----------------------------------------------------------------------------

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
	id = Spacelines_SolarWinnd
	title = Soalr Wind MEasurements
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_SolarWinnd/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_SolarWinnd/size$
	@dataScale /= #$baseValue$
	scienceCap = 300
	requireAtmosphere = False
	situationMask = 48 // in space low, in space high
	biomeMask = 0

    RESULTS
    {
        default = You measure the strength and direction of solar wind particles.
        default = Kerbol's solar wind is measured at this altitude
        default = The computers log solar wind data

        SunInSpace = Solar wind spiral outward from Kerbol, possibly along its magnetic force lines
        SunInSpace = Oscillating measurements are logged before the instrument goes to safe-mode
        SunInSpaceLow = Very strong solar wind jetties are detected emanating from coronal holes
        SunInSpaceLow = Solar wind measurement show wind speeds lower here than from near Kerbin
        SunInSpaceHigh = Solar wind measurements are recorded
        SunInSpaceHigh = Solar Wind data is logged while the KSC scientists fiercely debate whether it should be called solar wind speed or solar wind velocity

        MohoInSpace = Solar winds steadily bombard Moho's exposed surface
        MohoInSpaceLow = Despite lower speeds, the solar wind has a strong effect on Moho
        MohoInSpaceHigh = There is a significant amount of irregular solar wind activity near Moho

        EveInSpace = Eve definitely has a strong effect on solar wind direction
        EveInSpaceLow = Despite erratic behavior, Eve appears to deflect a good portion of the solar wind
        EveInSpaceHigh = The solar wind direction becomes more erratic closer to Kerbol

        GillyInSpace = Deflected and direct solar wind emissions clearly reach the surface of Gilly
        GillyInSpaceLow = Gilly is found to be hit by solar winds deflected by Eve
        GillyInSpaceHigh = Gilly measurements provide no conclusive data at this altitude

        KerbinInSpace = Solar wind speed and strength is recorded from around Kerbin
        KerbinInSpaceLow = Kerbol's solar wind emissions are definitely interacting with Kerbin's atmosphere
        KerbinInSpaceHigh = Wind speed is recorded for comparison with other planets
        KerbinInSpaceHigh = Solar Wind is somehow deflected by Kerbin. Scientists suggest comparing it with Magnetometer results

        MunInSpace = Solar wind levels are logged around the Mun
        MunInSpaceLow = There does not appear to be any wind deflection, so the Mun is hit by solar wind directly
        MunInSpaceHigh = Surface particles appear to be blasted into space

        MinmusInSpace = The instrument takes measurements from around Minmus
        MinmusInSpaceLow = Solar wind detection reveals the Minmus is also hit directly
        MinmusInSpaceHigh = Solar wind analysis complete: Lime

        DunaInSpace = The Instrument takes reading from around Duna
        DunaInSpaceLow = Tracking solar wind direction revealed that at least some seems to deflect and reach the lower atmosphere
        DunaInSpaceHigh = The measured solar wind is strong enough to blast away the lighter particles at the top of Duna's surface

        DresInSpace = Results recorded. Solar wind blasts Dres' surface directly
        DresInSpaceLow = Solar wind speed measurements indicate that the wind is actually accelerating as it gets farther from Kerbol
        DresInSpaceHigh = *static*
        DresInSpaceHigh = Kerbol emissions are still clearly detected around Dres

        JoolInSpace = Interference from Jool prevents conclusive results
        JoolInSpaceLow = Solar wind does not appear to affect the deeper layer of Jool's magnetosphere
        JoolInSpaceHigh = Solar winds are detected interacting with Jool's upper magnetosphere
        JoolInSpaceHigh = Jool is found to have a strong effect on solar wind direction

        LaytheInSpace = Laythe is detected to have a magnetosheath deflecting solar wind plasma, also affected by Jool's gravity
        LaytheInSpaceLow = Plasma ionization detected, Laythe must contain an ionosphere
        LaytheInSpaceHigh = Due to its proximity, Laythe interacts with a lot of solar particles deflected by Jool

        VallInSpace = There is no plasma interaction, suggesting no atmosphere around Vall
        VallInSpaceLow = KSC turned the knob to 11. Solar wind detected again
        VallInSpaceHigh = No solar wind detected. Have we left the Kerbol system?

        PolInSpace = Analysis from Pol received
        PolInSpaceLow = Analysis of the solar wind detected here suggests it was deflected here by Jool
        PolInSpaceHigh = The system is detecting increased wind activity as it approaches Pol

        TyloInSpace = Results make the scientists ponder what happened to Tylo's atmosphere
        TyloInSpaceLow = Despite Tylo's magnetosheath, there appears to be no solar wind interactions or atmosphere
        TyloInSpaceHigh = It appears that solar wind particles are deflected by Tylo's gravity

        BopInSpace = Data confirms that Jool has a large magnetosphere that influences wind patterns around it
        BopInSpaceLow = Jool's massive gravity deflects solar wind particles into and around Bop's path
        BopInSpaceHigh = The solar winds detected at this latitude above Bop follows very irregular patterns

        EelooInSpace = Data is collected from Eeloo
        EelooInSpaceLow = The solar wind appears to travel twice as fast here than when near Kerbin
        EelooInSpaceHigh = What little solar wind is detectable is traveling really fast!

        //Outer Planets Mod

        SarnusInSpaceLow = Solar wind measurements confirm that Sarnus is largely shielded from solar particles
        SarnusInSpaceHigh = Solar particles are deflected and disturbed, likely by the planet's powerful magnetic field
        SarnusInSpaceHigh = Solar winds are detected to be interacting with Sarnus' outer magnetoshpere

        TektoInSpace = Tekto is fairly well shielded from Solar particles by its parent planet
        TektoInSpace = Detected particles appear to be deflected by Sarnus' magnetic field

        SlateInSpaceHigh = Results make the scientists ponder what happened to Slate's atmosphere
        SlateInSpaceHigh = Kerbol's emissions are still clearly detected this far out
        SlateInSpaceLow = Surface particles appear to be blasted into space

        HaleInSpace = Interference from Sarnus' rings prevents conclusive results
        HaleInSpaceLow = The moon is deeply shielded by the gas giant's powerful magnetosphere

        OvokInSpace = Data is collected near Ovok
        OvokInSpace = The solar wind appears to travel twice as fast here than when near Kerbin

        UrlumInSpaceLow = Urlum's magnetosphere is powerful enough to shield the planet from much of the solar plasma
        UrlumInSpaceHigh = Solar particles are definitely being deflected by the planet's magnetic field
        UrlumInSpaceHigh = The measured deflections of solar plasma seem to indicate a twisting rotation along Urlum's magnetotail

        WalInSpaceHigh = Urlum is measured to provide some shielding from solar wind
        WalInSpaceLow = Solar wind analysis complete: Banana

        TalInSpace = Solar wind analysis complete: Tapioca
        TalInSpace = Even at this distance, the instrument can still feel the effects of Kerbol's solar particle emissions

        PriaxInSpace = Measurements provided a clearer picture of Urlum's magnetosphere but do not show any significant interaction with the small moon
        PriaxInSpaceLow = Despite Urlum's magnetic protection, Priax appears to be exposed to some solar wind weathering

        PoltaInSpace = Despite Urlum's magnetic protection, Polta appears to be exposed to some solar wind weathering
        PoltaInSpace = The solar wind appears to travel twice as fast here than when near Kerbin

        NeidonInSpaceLow = Neidon's complex magnetic field has interesting effects on incoming solar wind, although it is still well deflected
        NeidonInSpaceHigh = Solar winds are detected interacting with Neidon's upper magnetosphere

        ThatmoInSpaceHigh = The measured solar wind appears to be eroding a tiny percentage of Thatmo's upper atmosphere
        ThatmoInSpaceLow = Thatmo's reverse orbit carves an intersting path through the solar wind active inside Neidon's magnetosphere
    }

    KERBALISM_EXPERIMENT 
	{
		VirtualBiome = NoBiome
        VirtualBiome = InnerBelt
        VirtualBiome = OuterBelt
        VirtualBiome = Magnetosphere
        VirtualBiome = Storm
        VirtualBiome = Interstellar

        Situation = Space@VirtualBiomes
	}
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_solarwind]]]:NEEDS[FeatureScience] {
    %Tag_Spacelines_SolarWind = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[dmSolarParticles]]]:NEEDS[FeatureScience] {
    %Tag_Spacelines_SolarWind = True
}

// Experiment module
@PART[*]:HAS[#Tag_Spacelines_SolarWind[True]]:NEEDS[FeatureScience] {
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_SolarWinnd
	}
}

// Setting Experiment Values
@PART[*]:HAS[#Tag_Spacelines_SolarWind[True]]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_SolarWinnd]] {
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWinnd/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWinnd/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWinnd/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWinnd/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWinnd/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWinnd/ResourceRates$

		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWinnd/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWinnd/size$
	}
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[#Tag_Spacelines_SolarWind[True]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

// ----------------------------------------------------------------------------
// Cleaning old science modules
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_solarwind]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
  !MODULE[*ModuleScience*]:HAS[#experimentID[bd_solarwind]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[dmSolarParticles]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
  !MODULE[*ModuleScience*]:HAS[#experimentID[dmSolarParticles]] {}
}

