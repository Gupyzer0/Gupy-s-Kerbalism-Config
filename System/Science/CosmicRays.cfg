// ============================================================================
// Cosmic Rays Experiment
// ============================================================================

EXPERIMENT_DEFINITION
{
	id = Spacelines_CosmicRays1
	title = Cosmic Ray Science
	baseValue = 3
	scienceCap = 3
	dataScale = 0.025
	requireAtmosphere = False
	situationMask = 48
	biomeMask = 0

	RESULTS
	{
		default = The cosmic ray radiation data from the Geiger-Muller tube is recorded.
	}

	KERBALISM_EXPERIMENT
	{
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0

        VirtualBiome = NoBiome
		VirtualBiome = Magnetosphere
        VirtualBiome = Storm
        VirtualBiome = OuterBelt
        VirtualBiome = InnerBelt
        VirtualBiome = Interstellar

        Situation = Surface
		Situation = FlyingLow
		Situation = FlyingHigh
		Situation = InSpaceLow@VirtualBiomes
		Situation = InSpaceHigh@VirtualBiomes
	}
}

//Cosmic Ray tier 2: Scintillation Counter Cosmic Ray Telescopes used on many spacecraft
EXPERIMENT_DEFINITION
{
	id = Spacelines_CosmicRays2
	title = Cosmic Ray Science 2
	baseValue = 3
	scienceCap = 3
	dataScale = 0.08
	requireAtmosphere = False
	situationMask = 48
	biomeMask = 0

	RESULTS
	{
		default = The cosmic ray radiation data from the Scintillation Counter Cosmic Ray Telescope has been collected.
	}
	
	KERBALISM_EXPERIMENT
	{
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0
		IncludeExperiment = Spacelines_CosmicRays1
	
		VirtualBiome = NoBiome
		VirtualBiome = Magnetosphere
        VirtualBiome = Storm
        VirtualBiome = OuterBelt
        VirtualBiome = InnerBelt
        VirtualBiome = Interstellar

        Situation = Surface
		Situation = FlyingLow
		Situation = FlyingHigh
		Situation = InSpaceLow@VirtualBiomes
		Situation = InSpaceHigh@VirtualBiomes
	}
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------
// Modules being replaced:
// -----------------------
// + bd_GeigerCounter -> Spacelines_CosmicRays1
// + bd_cosmicRay -> Spacelines_CosmicRays2
// + bd_TrappedRadiation -> Spacelines_CosmicRays2
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_GeigerCounter]]]:NEEDS[FeatureScience] {
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_CosmicRays1]] {
        &name = Experiment
        &experiment_id = Spacelines_CosmicRays1
    }
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_cosmicRay]]]:NEEDS[FeatureScience] {
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_CosmicRays2]] {
        &name = Experiment
        &experiment_id = Spacelines_CosmicRays2
    }
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_TrappedRadiation]]]:NEEDS[FeatureScience] {
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_CosmicRays2]] {
        &name = Experiment
        &experiment_id = Spacelines_CosmicRays2
    }
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_GeigerCounter]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_CosmicRays*]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_GeigerCounter]]/animationName$
    }
}

@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_cosmicRay]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_CosmicRays*]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_cosmicRay]]/animationName$
    }
}

@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_TrappedRadiation]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_CosmicRays*]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_TrappedRadiation]]/animationName$
    }
}

// ----------------------------------------------------------------------------
// Experiments Reconfiguration
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[Experiment]]:AFTER[KerbalismDefault]
{
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_CosmicRays1]]
	{
		%ec_rate = 0.05
		%data_rate = 3
		@data_rate /= 180
		%requires = OrbitMinEccentricity:0.04
		%resources = 
		%experiment_desc = A geiger-muller counter. Used to study the radiation environment; requires an eccentric orbit to study radiation belts and altitude-based variation.
        allow_shrouded = false
	}
}

@PART[*]:HAS[@MODULE[Experiment]]:AFTER[KerbalismDefault]
{
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_CosmicRays2]]
	{
		%ec_rate = 0.002
		%data_rate = 0.25
		@data_rate /= 600
		%requires = 
		%resources = 
		%experiment_desc = An improved cosmic ray detector. Used to study the radiation environment; requires an eccentric orbit to study radiation belts and altitude-based variation.
        allow_shrouded = false
	}
}

// ----------------------------------------------------------------------------
// Cleaning old science modules
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_GeigerCounter]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_GeigerCounter]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_cosmicRay]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_cosmicRay]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_TrappedRadiation]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_TrappedRadiation]] {}
}
