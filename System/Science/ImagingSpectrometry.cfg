// ============================================================================
// Imaging Spectrometry
// ============================================================================

// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_EXPERIMENT_VALUES:NEEDS[FeatureScience]
{
	%SPACELINES
	{
        Spacelines_IRSpectrometry
        {
            ECCost = 0.1
			size = 16 						
			value = 3
			duration = 1800 
			SetupMass =
			SetupCost =
			UnlockTech = science2
			requirements =
			ResourceRates =
			CrewRequirement =
        }

        Spacelines_UVSpectrometry
        {
            ECCost = 0.1
			size = 16 						
			value = 3
			duration = 1800 
			SetupMass =
			SetupCost =
			UnlockTech = science2
			requirements =
			ResourceRates = 
			CrewRequirement =
        }

        Spacelines_MWSpectrometry
        {
            ECCost = 0.05
			size = 9					
			value = 4
			duration = 3600
			SetupMass =
			SetupCost = 
			UnlockTech = science5
			requirements =
			ResourceRates = 
			CrewRequirement =
        }

        Spacelines_GammaRaySpectrometry
        {
            ECCost = 0.05
			size = 0.75
			value = 6
			duration = 6000
			SetupMass =
			SetupCost = 
			UnlockTech = science6
			requirements =
			ResourceRates = 
			CrewRequirement =
        }

        Spacelines_MultiSpectralSpectrometry
        {
            ECCost = 1
			size = 64
			value = 10
			duration = 21600 
			SetupMass =
			SetupCost =
			UnlockTech = science8
			requirements =
			ResourceRates = 
			CrewRequirement =
        }       
    }
}

// ----------------------------------------------------------------------------
// Science Definitions 
// ----------------------------------------------------------------------------

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_IRSpectrometry
    title = Infrared Spectrometry
   
    scienceCap = 3
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IRSpectrometry/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IRSpectrometry/size$
	@dataScale /= #$baseValue$

    RESULTS
    {
        default = The spectral content of the light and electromagnetic light is captured.
    }

    KERBALISM_EXPERIMENT
    {
		Situation = InSpaceHigh
		Situation = InSpaceLow
    }
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_UVSpectrometry
    title = Ultra Violet Spectrometry
    
    scienceCap = 3
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVSpectrometry/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVSpectrometry/size$
	@dataScale /= #$baseValue$

    RESULTS
    {
        default = The spectral content of the light and electromagnetic light is captured.
    }
	
    KERBALISM_EXPERIMENT
    {
        IncludeExperiment = Spacelines_IRSpectrometry
        Situation = InSpaceHigh
		Situation = InSpaceLow
    }
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_MWSpectrometry
    title = Microwave Spectrometry
    
    scienceCap = 4
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MWSpectrometry/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MWSpectrometry/size$
	@dataScale /= #$baseValue$

    RESULTS
    {
        default = The spectral content of the light and electromagnetic light is captured.
    }
	
    KERBALISM_EXPERIMENT
    {
        IncludeExperiment = Spacelines_UVSpectrometry
        Situation = InSpaceLow
    }
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_GammaRaySpectrometry
    title = Gamma Ray Spectrometry

    scienceCap = 6
    baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRaySpectrometry/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRaySpectrometry/size$
	@dataScale /= #$baseValue$

    RESULTS
    {
        default = The spectral content of the light and electromagnetic light is captured.
    }
	
    KERBALISM_EXPERIMENT
    {
        IncludeExperiment = Spacelines_MWSpectrometry
        Situation = InSpaceHigh
		Situation = InSpaceLow
    }
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_MultiSpectralSpectrometry
    title = Multispectral Imaging Spectrometry
    
    scienceCap = 10
    baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRaySpectrometry/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRaySpectrometry/size$
	@dataScale /= #$baseValue$

    RESULTS
    {
        default = The spectral content of the light and electromagnetic light is captured.
    }

    KERBALISM_EXPERIMENT
    {
		IncludeExperiment = Spacelines_GammaRaySpectrometry
        Situation = InSpaceHigh
		Situation = InSpaceLow
    }
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------
// Modules being replaced:
// -----------------------
// + bd_IRspec
// + bd_UVspec
// + bd_microwaveSpec
// + bd_gammaRay
// + bd_multiSpec
// + dmImagingPlatform
// ----------------------------------------------------------------------------

// Tagging all spectrometer parts
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_IRspec]]]:NEEDS[FeatureScience] {
    %Tag_Spectrometer = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_UVspec]]]:NEEDS[FeatureScience] {
    %Tag_Spectrometer = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_microwaveSpec]]]:NEEDS[FeatureScience] {
    %Tag_Spectrometer = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_gammaRay]]]:NEEDS[FeatureScience] {
    %Tag_Spectrometer = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_multiSpec]]]:NEEDS[FeatureScience] {
    %Tag_Spectrometer = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[dmImagingPlatform]]]:NEEDS[FeatureScience] {
    %Tag_Spectrometer = True
}

// Creating configure module for all tagged parts
@PART[*]:HAS[#Tag_Spectrometer]:NEEDS[FeatureScience] {
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_IRSpectrometry
	}
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_UVSpectrometry
	}
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_MWSpectrometry
	}
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_GammaRaySpectrometry
	}
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_MultiSpectralSpectrometry
	}

    MODULE
	{
		name = Configure
		title = Spectrometer Experiment
		slots = 1

		SETUP
		{
            name = Infrared Spectrometer
			desc = Provides data about atmospheric composition, temperature and vertical structure; can't be used from too far away.

			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_IRSpectrometry
			}
        }
        SETUP
		{
            name = Ultraviolet Spectrometer
			desc = Measures the extinction properties of atmospheres in the ultraviolet spectrum.

			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_UVSpectrometry
			}
        }
        SETUP
		{
            name = Microwave Spectrometer
			desc = Used for measuring tropospheric temperature profiles, water vapor abundances, cloud liquid water content, and earth surface temperatures; can't be used from too far away.

			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_MWSpectrometry
			}
        }
        SETUP
		{
            name = Gamma Ray Spectrometer
			desc = Measures the distribution of the intensity of gamma radiation versus the energy of each photon for getting the composition of a celestial body.

			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_GammaRaySpectrometry
			}
        }
        SETUP
		{
            name = Multispectral Spectrometer
			desc = Installs an incredibly advanced camera capable of perfoming full-spectrum imagery, covering everything from visible, to UV, infared, and beyond. It is truly the camera to rule all cameras.

			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_MultiSpectralSpectrometry
			}
        }
    }
}

// Experiment Values
@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Spectrometer?Experiment]]]:NEEDS[FeatureScience]
{
	@MODULE[Configure]:HAS[#title[Spectrometer?Experiment]]
	{
		@SETUP:HAS[#name[Infrared?Spectrometer]]
		{
			cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IRSpectrometry/SetupCost
            mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IRSpectrometry/SetupMass
            tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IRSpectrometry/UnlockTech
		}
        @SETUP:HAS[#name[Ultraviolet?Spectrometer]]
		{
			cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVSpectrometry/SetupCost
            mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVSpectrometry/SetupMass
            tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVSpectrometry/UnlockTech
		}
        @SETUP:HAS[#name[Microwave?Spectrometer]]
		{
			cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MWSpectrometry/SetupCost
            mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MWSpectrometry/SetupMass
            tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MWSpectrometry/UnlockTech
		}
        @SETUP:HAS[#name[Gamma?Ray?Spectrometer]]
		{
			cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRaySpectrometry/SetupCost
            mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRaySpectrometry/SetupMass
            tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRaySpectrometry/UnlockTech
		}
        @SETUP:HAS[#name[Multispectral?Spectrometer]]
		{
			cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MultiSpectralSpectrometry/SetupCost
            mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MultiSpectralSpectrometry/SetupMass
            tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MultiSpectralSpectrometry/UnlockTech
		}
    }

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_IRSpectrometry]]
	{
        %ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IRSpectrometry/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IRSpectrometry/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IRSpectrometry/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IRSpectrometry/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IRSpectrometry/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IRSpectrometry/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IRSpectrometry/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IRSpectrometry/size$
    }
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_UVSpectrometry]]
	{
        %ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVSpectrometry/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVSpectrometry/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVSpectrometry/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVSpectrometry/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVSpectrometry/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVSpectrometry/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVSpectrometry/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVSpectrometry/size$
    }
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_MWSpectrometry]]
	{
        %ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MWSpectrometry/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MWSpectrometry/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MWSpectrometry/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MWSpectrometry/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MWSpectrometry/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MWSpectrometry/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MWSpectrometry/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MWSpectrometry/size$
    }
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_GammaRaySpectrometry]]
	{
        %ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRaySpectrometry/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRaySpectrometry/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRaySpectrometry/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRaySpectrometry/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRaySpectrometry/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRaySpectrometry/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRaySpectrometry/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRaySpectrometry/size$
    }
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_MultiSpectralSpectrometry]]
	{
        %ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MultiSpectralSpectrometry/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MultiSpectralSpectrometry/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MultiSpectralSpectrometry/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MultiSpectralSpectrometry/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MultiSpectralSpectrometry/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MultiSpectralSpectrometry/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MultiSpectralSpectrometry/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MultiSpectralSpectrometry/size$
    }
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE:HAS[#Tag_Spectrometer[True]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

// ----------------------------------------------------------------------------
// Cleaning old science modules
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_IRspec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_IRspec]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_UVspec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_UVspec]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_microwaveSpec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_microwaveSpec]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_gammaRay]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_gammaRay]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_multiSpec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_multiSpec]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[dmImagingPlatform]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[dmImagingPlatform]] {}
}
