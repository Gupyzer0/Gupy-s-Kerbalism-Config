// ============================================================================
// Imaging Spectrometry
// ============================================================================

// ----------------------------------------------------------------------------
// Science Definitions 
// ----------------------------------------------------------------------------

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_IRSpectrometry
    title = Infrared Spectrometry
    baseValue = 6
    scienceCap = 6
    dataScale = 2.66 //1
    requireAtmosphere = False
    situationMask = 48
    biomeMask = 0

    RESULTS
    {
        default = The spectral content of the light and electromagnetic light is captured.
    }

    KERBALISM_EXPERIMENT
    {
		Situation = InSpaceHigh
		Situation = InSpaceLow
    }
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_UVSpectrometry
    title = Ultra Violet Spectrometry
    baseValue = 6
    scienceCap = 6
    dataScale = 2.66 //1
    requireAtmosphere = False
    situationMask = 48
    biomeMask = 0

    RESULTS
    {
        default = The spectral content of the light and electromagnetic light is captured.
    }
	
    KERBALISM_EXPERIMENT
    {
        IncludeExperiment = Spacelines_IRSpectrometry
        Situation = InSpaceHigh
		Situation = InSpaceLow
    }
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_MWSpectrometry
    title = Microwave Spectrometry
    baseValue = 6
    scienceCap = 6
    dataScale = 2.66//1
    requireAtmosphere = False
    situationMask = 48
    biomeMask = 0

    RESULTS
    {
        default = The spectral content of the light and electromagnetic light is captured.
    }
	
    KERBALISM_EXPERIMENT
    {
        IncludeExperiment = Spacelines_IRSpectrometry
        Situation = InSpaceLow
    }
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_GammaRaySpectrometry
    title = Gamma Ray Spectrometry
    baseValue = 3
    scienceCap = 3
    dataScale = 2.66
    requireAtmosphere = False
    situationMask = 48
    biomeMask = 0

    RESULTS
    {
        default = The spectral content of the light and electromagnetic light is captured.
    }
	
    KERBALISM_EXPERIMENT
    {
        IncludeExperiment = Spacelines_MultiSpectralSpectrometry
        Situation = InSpaceHigh
		Situation = InSpaceLow
    }
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_MultiSpectralSpectrometry
    title = Multispectral Imaging Spectrometry
    baseValue = 8
    scienceCap = 12
    dataScale = 21.3
    requireAtmosphere = False
    situationMask = 48
    biomeMask = 0

    RESULTS
    {
        default = The spectral content of the light and electromagnetic light is captured.
    }

    KERBALISM_EXPERIMENT
    {
		IncludeExperiment = Spacelines_UVSpectrometry
        Situation = InSpaceHigh
		Situation = InSpaceLow
    }
}

// ----------------------------------------------------------------------------
// Progression
//----------------------------------------------------------------------------
// Spacelines_IRSpectrometry -> Spacelines_UVSpectrometry -+-> Spacelines_MultiSpectralSpectrometry -> Spacelines_GammaRaySpectrometry
//                          |-> Spacelines_MWSpectrometry

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------
// Modules being replaced:
// -----------------------
// + bd_IRspec
// + bd_UVspec
// + bd_microwaveSpec
// + bd_gammaRay
// + bd_multiSpec
// + dmImagingPlatform
// ----------------------------------------------------------------------------

// Tagging all spectrometer parts
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_IRspec]]]:NEEDS[FeatureScience] {
    %Configure_Spectrometer = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_UVspec]]]:NEEDS[FeatureScience] {
    %Configure_Spectrometer = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_microwaveSpec]]]:NEEDS[FeatureScience] {
    %Configure_Spectrometer = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_gammaRay]]]:NEEDS[FeatureScience] {
    %Configure_Spectrometer = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_multiSpec]]]:NEEDS[FeatureScience] {
    %Configure_Spectrometer = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[dmImagingPlatform]]]:NEEDS[FeatureScience] {
    %Configure_Spectrometer = True
}

// Creating configure module for all tagged parts
@PART[*]:HAS[#Configure_Spectrometer]:NEEDS[FeatureScience] {
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_IRSpectrometry
	}
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_UVSpectrometry
	}
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_MWSpectrometry
	}
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_GammaRaySpectrometry
	}
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_MultiSpectralSpectrometry
	}

    MODULE
	{
		name = Configure
		title = Spectrometer Experiment
		slots = 1
		SETUP
		{
            name = Infrared Spectrometer
			desc = Provides data about atmospheric composition, temperature and vertical structure; can't be used from too far away.
            tech = science4
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_IRSpectrometry
			}
        }
        SETUP
		{
            name = Ultraviolet Spectrometer
			desc = Measures the extinction properties of atmospheres in the ultraviolet spectrum.
            tech = science5
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_UVSpectrometry
			}
        }
        SETUP
		{
            name = Microwave Spectrometer
			desc = Used for measuring tropospheric temperature profiles, water vapor abundances, cloud liquid water content, and earth surface temperatures; can't be used from too far away.
            tech = science5
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_MWSpectrometry
			}
        }
        SETUP
		{
            name = Gamma Ray Spectrometer
			desc = Measures the distribution of the intensity of gamma radiation versus the energy of each photon for getting the composition of a celestial body.
            tech = science6
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_GammaRaySpectrometry
			}
        }
        SETUP
		{
            name = Multispectral Spectrometer
			desc = Installs an incredibly advanced camera capable of perfoming full-spectrum imagery, covering everything from visible, to UV, infared, and beyond. It is truly the camera to rule all cameras.
            tech = science7
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_MultiSpectralSpectrometry
			}
        }
    }
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Spectrometer?Experiment]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment]
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

// ----------------------------------------------------------------------------
// Experiments Reconfiguration
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[Experiment]]:AFTER[KerbalismDefault]
{
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_IRSpectrometry]]
	{
		%ec_rate = 0.1
		%data_rate = 16
		@data_rate /= 1800 
		%requires = 
		%resources = 
		%experiment_desc = Infrared Imaging Spectrometer (IRIS). Provides data about atmospheric composition, temperature and vertical structure; can't be used from too far away.
		allow_shrouded = false
	}

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_UVSpectrometry]]
	{
		%ec_rate = 0.1
		%data_rate = 16
		@data_rate /= 1800
		%requires = 
		%resources = 
		%experiment_desc = Ultraviolet Spectrometer. Measures the extinction properties of atmospheres.
		allow_shrouded = false
	}

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_MWSpectrometry]]
	{
		%ec_rate = 0.05
		%data_rate = 16
		@data_rate /= 21600 // 6 hours
		%requires = 
		%resources = 
		%experiment_desc = Microwave Spectrometer. Used for measuring tropospheric temperature profiles, water vapor abundances, cloud liquid water content, and earth surface temperatures.
		allow_shrouded = false
	}

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_GammaRaySpectrometry]]
	{
		%ec_rate = 0.05
		%data_rate = 16
		@data_rate /= 1800
		%requires = 
		%resources = 
		%experiment_desc = Measures the distribution of the intensity of gamma radiation versus the energy of each photon for getting the composition of a celestial body.
		allow_shrouded = false
	}

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_MultiSpectralSpectrometry]]
	{
		%ec_rate = 1
		%data_rate = 64
		@data_rate /= 1800
		%requires = 
		%resources = 
		%experiment_desc = Installs an incredibly advanced camera capable of perfoming full-spectrum imagery, covering everything from visible, to UV, infared, and beyond. It is truly the camera to rule all cameras. 
		allow_shrouded = false
	}
}

// ----------------------------------------------------------------------------
// Cleaning old science modules
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_IRspec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_IRspec]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_UVspec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_UVspec]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_microwaveSpec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_microwaveSpec]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_gammaRay]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_gammaRay]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_multiSpec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_multiSpec]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[dmImagingPlatform]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[dmImagingPlatform]] {}
}
