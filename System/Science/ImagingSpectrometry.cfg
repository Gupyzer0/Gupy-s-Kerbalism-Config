// ============================================================================
// Imaging Spectrometry
// ============================================================================

// ----------------------------------------------------------------------------
// Science Definitions 
// ----------------------------------------------------------------------------

EXPERIMENT_DEFINITION
{
    id = Spacelines_IRSpectrometry
    title = Infrared Spectrometry
    baseValue = 3
    scienceCap = 3
    dataScale = 3685
    requireAtmosphere = False
    situationMask = 48
    biomeMask = 0

    RESULTS
    {
        default = The spectral content of the light and electromagnetic light is captured.
    }

    KERBALISM_EXPERIMENT
    {
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0
    }
}

EXPERIMENT_DEFINITION
{
    id = Spacelines_UVSpectrometry
    title = Ultra Violet Spectrometry
    baseValue = 3
    scienceCap = 3
    dataScale = 4717 //600 byte/s
    requireAtmosphere = False
    situationMask = 48
    biomeMask = 0

    RESULTS
    {
        default = The spectral content of the light and electromagnetic light is captured.
    }
	
    KERBALISM_EXPERIMENT
    {
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0
        IncludeExperiment = Spacelines_IRSpectrometry
    }
}

EXPERIMENT_DEFINITION
{
    id = Spacelines_MWSpectrometry
    title = Microwave Spectrometry
    baseValue = 3
    scienceCap = 3
    dataScale = 4717 //600 byte/s
    requireAtmosphere = False
    situationMask = 48
    biomeMask = 0

    RESULTS
    {
        default = The spectral content of the light and electromagnetic light is captured.
    }
	
    KERBALISM_EXPERIMENT
    {
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0
        IncludeExperiment = Spacelines_UVSpectrometry
    }
}

EXPERIMENT_DEFINITION
{
    id = Spacelines_GammaRaySpectrometry
    title = Gamma Ray Spectrometry
    baseValue = 3
    scienceCap = 3
    dataScale = 4717 //600 byte/s
    requireAtmosphere = False
    situationMask = 48
    biomeMask = 0

    RESULTS
    {
        default = The spectral content of the light and electromagnetic light is captured.
    }
	
    KERBALISM_EXPERIMENT
    {
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0
        IncludeExperiment = Spacelines_MWSpectrometry
    }
}

EXPERIMENT_DEFINITION
{
    id = Spacelines_MultiSpectralSpectrometry
    title = Multispectral Imaging Spectrometry
    baseValue = 6
    scienceCap = 6
    dataScale = 15135.12 //1.925 Kilobyte/s
    requireAtmosphere = False
    situationMask = 48
    biomeMask = 0

    RESULTS
    {
        default = The spectral content of the light and electromagnetic light is captured.
    }

    KERBALISM_EXPERIMENT
    {
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0
		IncludeExperiment = Spacelines_UVSpectrometry
    }
}

// ----------------------------------------------------------------------------
// Progression
//----------------------------------------------------------------------------
// Spacelines_IRSpectrometry -> Spacelines_UVSpectrometry -+-> Spacelines_MultiSpectralSpectrometry
//                                                         |
//                                                         +-> Spacelines_MWSpectrometry -> Spacelines_GammaRaySpectrometry

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------
// Modules being replaced:
// -----------------------
// + bd_IRspec -> Spacelines_IRSpectrometry
// + bd_UVspec -> Spacelines_UVSpectrometry
// + bd_microwaveSpec -> Spacelines_MWSpectrometry
// + bd_gammaRay -> Spacelines_GammaRaySpectrometry
// + bd_multiSpec -> Spacelines_MultiSpectralSpectrometry
// + dmImagingPlatform -> Spacelines_MultiSpectralSpectrometry
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_IRspec]]]:NEEDS[FeatureScience] {
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_IRSpectrometry]] {
        &name = Experiment
        &experiment_id = Spacelines_IRSpectrometry
    }
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_UVspec]]]:NEEDS[FeatureScience] {
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_UVSpectrometry]] {
        &name = Experiment
        &experiment_id = Spacelines_UVSpectrometry
    }
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_microwaveSpec]]]:NEEDS[FeatureScience] {
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_MWSpectrometry]] {
        &name = Experiment
        &experiment_id = Spacelines_MWSpectrometry
    }
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_gammaRay]]]:NEEDS[FeatureScience] {
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_GammaRaySpectrometry]] {
        &name = Experiment
        &experiment_id = Spacelines_GammaRaySpectrometry
    }
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_multiSpec]]]:NEEDS[FeatureScience] {
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_MultiSpectralSpectrometry]] {
        &name = Experiment
        &experiment_id = Spacelines_MultiSpectralSpectrometry
    }
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[dmImagingPlatform]]]:NEEDS[FeatureScience] {
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_MultiSpectralSpectrometry]] {
        &name = Experiment
        &experiment_id = Spacelines_MultiSpectralSpectrometry
    }
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_IRspec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_IRSpectrometry]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_IRspec]]/animationName$
    }
}

@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_UVspec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_UVSpectrometry]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_UVspec]]/animationName$
    }
}

@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_microwaveSpec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_MWSpectrometry]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_microwaveSpec]]/animationName$
    }
}

@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_gammaRay]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_GammaRaySpectrometry]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_gammaRay]]/animationName$
    }
}

@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_multiSpec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_MultiSpectralSpectrometry]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_multiSpec]]/animationName$
    }
}

@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[dmImagingPlatform]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_MultiSpectralSpectrometry]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[dmImagingPlatform]]/animationName$
    }
}

// ----------------------------------------------------------------------------
// Experiments Reconfiguration
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[Experiment]]:AFTER[KerbalismDefault]
{
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_IRSpectrometry]]
	{
		%ec_rate = 0.1
		%data_rate = 16
		@data_rate /= 1800 
		%requires = 
		%resources = 
		%experiment_desc = Infrared Imaging Spectrometer (IRIS). Provides data about atmospheric composition, temperature and vertical structure; can't be used from too far away.
		allow_shrouded = false
	}

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_UVSpectrometry]]
	{
		%ec_rate = 0.1
		%data_rate = 16
		@data_rate /= 1800
		%requires = 
		%resources = 
		%experiment_desc = Ultraviolet Spectrometer. Measures the extinction properties of atmospheres.
		allow_shrouded = false
	}

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_MWSpectrometry]]
	{
		%ec_rate = 0.05
		%data_rate = 9
		@data_rate /= 21600 // 6 hours
		%requires = 
		%resources = 
		%experiment_desc = Ultraviolet Spectrometer. Measures the extinction properties of atmospheres.
		allow_shrouded = false
	}

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_GammaRaySpectrometry]]
	{
		%ec_rate = 0.05
		%data_rate = 0.75 //600 byte/s
		@data_rate /= 1800
		%requires = 
		%resources = 
		%experiment_desc = Ultraviolet Spectrometer. Measures the extinction properties of atmospheres.
		allow_shrouded = false
	}

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_MultiSpectralSpectrometry]]
	{
		%ec_rate = 1
		%data_rate = 64
		@data_rate /= 1800
		%requires = 
		%resources = 
		%experiment_desc = Visible and Infrared Mapping Spectrometer (VIMS). Provides information about surface minerals, atmosphere dynamics and ring composition.
		allow_shrouded = false
	}
}

// ----------------------------------------------------------------------------
// Cleaning old science modules
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_IRspec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_IRspec]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_UVspec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_UVspec]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_microwaveSpec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_microwaveSpec]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_gammaRay]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_gammaRay]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_multiSpec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_multiSpec]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[dmImagingPlatform]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[dmImagingPlatform]] {}
}
