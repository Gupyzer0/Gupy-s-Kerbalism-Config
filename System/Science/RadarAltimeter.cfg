// ============================================================================
// Radar Altimeter
// ============================================================================
// Modules being replaced:
// -----------------------
// + bd_radarAltimeter
// ----------------------------------------------------------------------------

// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_EXPERIMENT_VALUES:NEEDS[FeatureScience]
{
	%SPACELINES
	{
        Spacelines_RadarAltimeter
        {
            ECCost = 0.05
            size = 1.5 						
            value = 12
            duration = 3600 	
            requirements = 
            ResourceRates =
            CrewRequirement = 
        }
    }
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
	id = Spacelines_RadarAltimeter
	title = Radar Altimetry Data
    baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RadarAltimeter/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_RadarAltimeter/size$
	@dataScale /= #$baseValue$	
	scienceCap = 6
	requireAtmosphere = False
	situationMask = 28 //flying low, flying high, in space low
	biomeMask = 28 //flying low, flying high, in space low
	
    RESULTS
	{
	    default = The radar pings off the surface below, giving accurate distance readings
	}

    KERBALISM_EXPERIMENT 
    {
        Situation = Space@Biomes
    }
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_radarAltimeter]]]:NEEDS[FeatureScience] {
    %Tag_Spacelines_RadarAltimeter = True
}

// Experiment module
@PART[*]:HAS[#Tag_Spacelines_RadarAltimeter[True]]:NEEDS[FeatureScience] {
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_RadarAltimeter
	}
}

// Setting Experiment Values
@PART[*]:HAS[#Tag_Spacelines_RadarAltimeter[True]]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_RadarAltimeter]] {
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RadarAltimeter/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RadarAltimeter/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RadarAltimeter/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RadarAltimeter/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RadarAltimeter/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RadarAltimeter/ResourceRates$

		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RadarAltimeter/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_RadarAltimeter/size$
	}
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[#Tag_Spacelines_RadarAltimeter[True]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

// ----------------------------------------------------------------------------
// Cleaning old science modules
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_radarAltimeter]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
  !MODULE[*ModuleScience*]:HAS[#experimentID[bd_radarAltimeter]] {}
}
