// ============================================================================
// Imaging Spectrometry
// ============================================================================
// Modules being replaced:
// -----------------------
// + bd_massSpec
// + bd_dust
// ----------------------------------------------------------------------------

// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_EXPERIMENT_VALUES:NEEDS[FeatureScience]
{
	%SPACELINES
	{
		Spacelines_MassSpectrometry{
			ECCost = 0.05
			size = 3						
			value = 7								
			duration = 7200 				
			requirements = 
			ResourceRates =
			CrewRequirement = 
		}
	}
}

// ----------------------------------------------------------------------------
// Science Definitions 
// ----------------------------------------------------------------------------

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
	id = Spacelines_MassSpectrometry
	title = Mass Spectrum Analysis
	
	scienceCap = 8
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MassSpectrometry/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_MassSpectrometry/size$
	@dataScale /= #$baseValue$

	RESULTS
	{
        default = You analyze the composition of the atmosphere as it passes through the spectrometer.
        default = Various elements such as nitrogen, carbon and oxygen are present in your readings along with other trace elements.
        default = The slight variations in elemental levels here will require a longer term analysis but at least you got a basic reading.
	}

    KERBALISM_EXPERIMENT 
	{	
		Situation = Surface@Biomes
		Situation = FlyingLow
		Situation = FlyingHigh
		Situation = InSpaceLow
		Situation = InSpaceHigh
	}
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------

// Tagging all magnetometer parts
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_massSpec]]]:NEEDS[FeatureScience] {
    %Tag_massSpectrometry = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_dust]]]:NEEDS[FeatureScience] {
    %Tag_massSpectrometry = True
}

// Experiment module
@PART[*]:HAS[#Tag_massSpectrometry[True]]:NEEDS[FeatureScience] {
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_MassSpectrometry
	}
}

// Setting Experiment Values
@PART[*]:HAS[#Tag_massSpectrometry[True]]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_MassSpectrometry]] {
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry/ResourceRates$

		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry/size$
	}
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[#Tag_massSpectrometry[True]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

// ----------------------------------------------------------------------------
// Cleaning replaced experiments
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_massSpec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_massSpec]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_dust]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_dust]] {}
}
