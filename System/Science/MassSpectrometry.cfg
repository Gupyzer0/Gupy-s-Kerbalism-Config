// ============================================================================
// Imaging Spectrometry
// ============================================================================

// ----------------------------------------------------------------------------
// Science Definitions 
// ----------------------------------------------------------------------------

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
	id = Spacelines_MassSpectrometry
	title = Mass Spectrum Analysis
	baseValue = 8
	scienceCap = 8
	dataScale = 1
	requireAtmosphere = False
	situationMask = 31 //surface landed  flying low, flying high, in space low
	biomeMask = 1 //surface landed

	RESULTS
	{
        default = You analyze the composition of the atmosphere as it passes through the spectrometer.
        default = Various elements such as nitrogen, carbon and oxygen are present in your readings along with other trace elements.
        default = The slight variations in elemental levels here will require a longer term analysis but at least you got a basic reading.
	}

    KERBALISM_EXPERIMENT 
	{	
		Situation = Surface@Biomes
		Situation = FlyingLow
		Situation = FlyingHigh
		Situation = InSpaceLow
	}
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------
// Modules being replaced:
// -----------------------
// + bd_massSpec -> Spacelines_MassSpectrometry
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_massSpec]]]:NEEDS[FeatureScience] {
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_MassSpectrometry]] {
        &name = Experiment
        &experiment_id = Spacelines_MassSpectrometry
    }
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_massSpec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_MassSpectrometry]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_massSpec]]/animationName$
    }
}

// ----------------------------------------------------------------------------
// Experiments Reconfiguration
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[Experiment]]:AFTER[KerbalismDefault]
{
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_MassSpectrometry]]
	{
		%ec_rate = 0.05
		%data_rate = 3
		@data_rate /= 7200
		%experiment_desc = Device that measures the mass-to-charge ratio of ions. It is used to identify the chemical composition of a sample.
        allow_shrouded = false
	}
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------
// If there's an experiment with a DMOS module take their animations and insert them
// into the previously created Experiment module
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_massSpec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_MassSpectrometry]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_massSpec]]/animationName$
    }
}

// ----------------------------------------------------------------------------
// Cleaning replaced experiments
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_massSpec]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_massSpec]] {}
}
