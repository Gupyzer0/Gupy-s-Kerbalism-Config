// ============================================================================
// Visible Imaging (TV Cameras)
// ============================================================================
// Modules being replaced:
// -----------------------
// + bd_weather
// + bd_camera
// + bd_SiteSurvey
// ----------------------------------------------------------------------------

// ----------------------------------------------------------------------------
// Science Definitions 
// ----------------------------------------------------------------------------

// Visible Imaging 1, Early TV Cameras from Mariner B, Ranger Block 2 and X-15
EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_VisibleImaging1
    title = Video Imaging
    baseValue = 1.5
    scienceCap = 1.5
    dataScale = 0.01
    requireAtmosphere = False
    situationMask = 63
    biomeMask = 29
	
    RESULTS
    {
        default = Images taken!
    }

    KERBALISM_EXPERIMENT
    {
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0
		IncludeExperiment = 
    }
}

// Visible Imaging 2, TV Cameras on Mariner 4
EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_VisibleImaging2
    title = Video Imaging 2
    baseValue = 2
    scienceCap = 2
    dataScale = 0.5
    requireAtmosphere = False
    situationMask = 63
    biomeMask = 29

    RESULTS
    {
        default = Images taken!
    }

    KERBALISM_EXPERIMENT
    {
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 
		IncludeExperiment = Spacelines_VisibleImaging1
    }
}

// Visible Imaging 3, TV Cameras on Mariner 10 and Viking
EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_VisibleImaging3
    title = Video Imaging 3
    baseValue = 3
    scienceCap = 3
    dataScale = 20
    requireAtmosphere = False
    situationMask = 63
    biomeMask = 29

    RESULTS
    {
        default = Images taken!
    }

    KERBALISM_EXPERIMENT
    {
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0
		IncludeExperiment = Spacelines_VisibleImaging2
    }
}

// Visible Imaging 4, Solid-State Imager on Galileo
EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_VisibleImaging4
    title = Video Imaging 4
    baseValue = 6
    scienceCap = 6
    dataScale = 500
    requireAtmosphere = False
    situationMask = 63
    biomeMask = 29

    RESULTS
    {
        default = Images taken!
    }
    KERBALISM_EXPERIMENT
    {
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0
		IncludeExperiment = Spacelines_VisibleImaging3
    }
}

// Visible Imaging 5, HiRISE on MRO
EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
    id = Spacelines_VisibleImaging5
    title = Video Imaging 5
    baseValue = 50
    scienceCap = 50
    dataScale = 50000
    requireAtmosphere = False
    situationMask = 63
    biomeMask = 29

    RESULTS
    {
        default = Images taken!
    }

    KERBALISM_EXPERIMENT
    {
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0
		IncludeExperiment = Spacelines_VisibleImaging4
    }
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------

// Patching tiers 1 to 4 with Spacelines_VisibleImaging1
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_weather]],#SSS_Tier[1]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging1]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging1
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_camera]],#SSS_Tier[1]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging1]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging1
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_SiteSurvey]],#SSS_Tier[1]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging1]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging1
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_weather]],#SSS_Tier[2]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging1]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging1
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_camera]],#SSS_Tier[2]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging1]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging1
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_SiteSurvey]],#SSS_Tier[2]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging1]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging1
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_weather]],#SSS_Tier[3]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging1]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging1
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_camera]],#SSS_Tier[3]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging1]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging1
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_SiteSurvey]],#SSS_Tier[3]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging1]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging1
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_weather]],#SSS_Tier[4]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging1]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging1
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_camera]],#SSS_Tier[4]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging1]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging1
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_SiteSurvey]],#SSS_Tier[4]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging1]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging1
    }
}

// Patching tiers 5 to 7 with Spacelines_VisibleImaging2
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_weather]],#SSS_Tier[5]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging2]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging2
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_camera]],#SSS_Tier[5]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging2]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging2
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_SiteSurvey]],#SSS_Tier[5]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging2]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging2
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_weather]],#SSS_Tier[6]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging2]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging2
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_camera]],#SSS_Tier[6]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging2]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging2
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_SiteSurvey]],#SSS_Tier[6]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging2]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging2
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_weather]],#SSS_Tier[7]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging2]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging2
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_camera]],#SSS_Tier[7]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging2]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging2
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_SiteSurvey]],#SSS_Tier[7]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging2]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging2
    }
}

// Patching tiers 8 with Spacelines_VisibleImaging3
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_weather]],#SSS_Tier[8]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging3]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging3
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_camera]],#SSS_Tier[8]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging3]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging3
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_SiteSurvey]],#SSS_Tier[8]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging3]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging3
    }
}

// Patching tiers 9 with Spacelines_VisibleImaging4
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_weather]],#SSS_Tier[9]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging4]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging4
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_camera]],#SSS_Tier[9]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging4]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging4
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_SiteSurvey]],#SSS_Tier[9]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging4]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging4
    }
}

// Patching tiers 10 with Spacelines_VisibleImaging5
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_weather]],#SSS_Tier[10]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging5]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging5
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_camera]],#SSS_Tier[10]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging5]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging5
    }
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_SiteSurvey]],#SSS_Tier[10]]:NEEDS[FeatureScience]
{
    &MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging5]] {
        &name = Experiment
        &experiment_id = Spacelines_VisibleImaging5
    }
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_weather]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging*]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_weather]]/animationName$
    }
}

@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_camera]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging*]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_camera]]/animationName$
    }
}

@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_SiteSurvey]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging*]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_SiteSurvey]]/animationName$
    }
}

// ----------------------------------------------------------------------------
// Experiments Reconfiguration
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[Experiment]]:AFTER[KerbalismDefault]
{
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging1]]
	{
		%ec_rate = 0.005
		%data_rate = 0.01
		@data_rate /= 1200 //20 minutes
		%requires = 
		%resources = 
		allow_shrouded = false
	}

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging2]]
	{
		%ec_rate = 0.008
		%data_rate = 0.5
		@data_rate /= 3600 //1 hour
		%requires = 
		%resources = 
		allow_shrouded = false
	}

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging3]]
	{
		%ec_rate = 0.031
		%data_rate = 20
		@data_rate /= 7200 //2 hours
		%requires = 
		%resources = 
		allow_shrouded = false
	}

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging4]]
	{
		%ec_rate = 0.023
		%data_rate = 500
		@data_rate /= 7200 //2 hours
		%requires = 
		%resources = 
		allow_shrouded = false
	}

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisibleImaging5]]
	{
		%ec_rate = 0.06
		%data_rate = 50000
		@data_rate /= 50000 //1day
		%requires = 
		%resources = 
		allow_shrouded = false
	}
}

// ----------------------------------------------------------------------------
// Cleaning old science modules
// ----------------------------------------------------------------------------

// Removing PlanetaryPhotography experiments
@PART[*]:HAS[@MODULE[Experiment]:HAS[#experimentID[Spacelines_Photos*]]]:NEEDS[FeatureScience] {
    !MODULE[Experiment]:HAS[#experimentID[Spacelines_Photos*]] {}
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_weather]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
  !MODULE[*ModuleScience*]:HAS[#experimentID[bd_weather]] {}
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_camera]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
  !MODULE[*ModuleScience*]:HAS[#experimentID[bd_camera]] {}
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_SiteSurvey]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
  !MODULE[*ModuleScience*]:HAS[#experimentID[bd_SiteSurvey]] {}
}
