// ============================================================================
// Gravity Experiments
// ============================================================================

// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_EXPERIMENT_VALUES:NEEDS[FeatureScience]
{
	%SPACELINES
	{   
        Spacelines_GammaRayAstronomy
		{
			ECCost = 2
			size = 5
			value = 3
			SetupMass = 
			SetupCost =			
			duration = 518400 // 6 days
			UnlockTech = 
			requirements = 
			ResourceRates = 
			CrewRequirement = 
		}

        Spacelines_UVAstronomy
        {
			ECCost = 17
			size = 70000
			value = 2800
			duration = 78892380 // 5 years 
			SetupMass =
			SetupCost =
			UnlockTech = science6
			requirements = 
			ResourceRates = 
			CrewRequirement = 
		}

        Spacelines_XrayAstronomy
		{
			ECCost = 23
			size = 70000
			value = 5600
			duration = 78892380 // 5 years
			SetupMass =
			SetupCost =
			UnlockTech = science7
			requirements =
			ResourceRates =
			CrewRequirement = 
		}

        Spacelines_VisualAstronomy
        {
            ECCost = 21
			size = 
			value = 			
			SetupMass =
			SetupCost =			
			duration = 157784760 // 5 years
			UnlockTech = science8
			requirements = 
			ResourceRates =
			CrewRequirement = 
        }

        Spacelines_InfraredAstronomy
        {
			ECCost = 30
			size = 70000	
			value = 12600
			duration = 78892380 // 5 years
			SetupMass =
			SetupCost =
			UnlockTech = science9
			requirements =
			ResourceRates =
			CrewRequirement = 
		}
	}
}

// ----------------------------------------------------------------------------
// Science Definitions 
// ----------------------------------------------------------------------------

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
	id = Spacelines_GammaRayAstronomy
	title = Photometer
	
	scienceCap = 3
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRayAstronomy/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRayAstronomy/size$
	@dataScale /= #$baseValue$

	RESULTS
	{
        default = Now we know from where all of those gamma rays come from!
	}

    KERBALISM_EXPERIMENT 
	{
        Situation = Space
		BodyAllowed = HomeBody
	}
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
	id = Spacelines_UVAstronomy
	title = Ultraviolet Telescope
	
	scienceCap = 12
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/size$
	@dataScale /= #$baseValue$

	RESULTS
	{
        default = You take high resolution images in the ultraviolet wavelength.
        default = You snap a number of ultraviolet images.
        default = You take ultraviolet images of a distant celestial object.
        default = You take high resolution UV images of far away structures in space like stars, nebulae, and novae.
        default = Ultraviolet observations appear to reveal the discovery of long-period pulsars. Fascinating!
	}

    KERBALISM_EXPERIMENT 
	{
        Situation = Space
		BodyAllowed = HomeBody
	}
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
	id = Spacelines_XrayAstronomy
	title = X-ray Imaging Telescope
	
	scienceCap = 8
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/size$
	@dataScale /= #$baseValue$

	RESULTS
	{
        default = You take high resolution images in the X-ray wavelength, hoping to get some cool stars in them.
        default = You snap a number of X-ray images. Unfortunately you can't seem to see through everything, as you had hoped.
        default = You take X-ray images of a distant object. It's still just a little bright dot as far as you can tell.
        default = The imaging device confirms that the nearby stars all emit their own X-rays, each with its own unique signature.
        default = The X-ray data shows what the eggheads call a 'dark star'. You presume they're talking about star-shaped christmas chocolates.
	}

    KERBALISM_EXPERIMENT 
	{
        Situation = Space
		BodyAllowed = HomeBody
	}
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
	id = Spacelines_VisualAstronomy
	title = Imaging Telescope
	
	scienceCap = 8
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/size$
	@dataScale /= #$baseValue$

	RESULTS
	{
        default = The image looks a little fuzzy. Did the technicians remember to clean the lenses before launch?
		default = The telescope returns images of a distant galaxy cluster, billions of light years away. The image is full of what appear to be stars, but on closer inspection, one can see that each and every one is its own galaxy.
	}

    KERBALISM_EXPERIMENT 
	{
        Situation = Space
		BodyAllowed = HomeBody
	}
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
	id = Spacelines_InfraredAstronomy
	title = Imaging Telescope
	
	scienceCap = 8
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_InfraredAstronomy/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_InfraredAstronomy/size$
	@dataScale /= #$baseValue$

	RESULTS
	{
		default = The telescope returns images of a distant galaxy cluster, billions of light years away. The image is full of what appear to be stars, but on closer inspection, one can see that each and every one is its own galaxy.
	}

    KERBALISM_EXPERIMENT 
	{
        Situation = InSpaceHigh
        BodyAllowed = Suns
	}
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------
// Modules being replaced by the configure:
// -----------------------
// + bd_XrayImaging
// + bd_UVscope
// + infraredTelescope
// + scopeScan
// + bd_orbitalScope -> manned
// + bd_TelescopeObservation -> manned -> ground based
// ----------------------------------------------------------------------------

// Tagging all atmospheric experiments parts
@PART[bluedog_Explorer_11]:NEEDS[FeatureScience,Bluedog_DB] { // Explorer 11
    %Tag_Spacelines_GammaRayAstronomy = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_XrayImaging]]]:NEEDS[FeatureScience] {
    %Tag_AstronomyExperiments = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_UVscope]]]:NEEDS[FeatureScience] {
    %Tag_AstronomyExperiments = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[infraredTelescope]]]:NEEDS[FeatureScience] {
    %Tag_AstronomyExperiments = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[scopeScan]]]:NEEDS[FeatureScience] {
    %Tag_AstronomyExperiments = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_orbitalScope]]]:NEEDS[FeatureScience] {
    %Tag_AstronomyExperiments = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_TelescopeObservation]]]:NEEDS[FeatureScience] {
    %Tag_AstronomyExperiments = True
}

// Explorer 11 gamma ray astronomy experiment
@PART[*]:HAS[#Tag_Spacelines_GammaRayAstronomy][True]]:NEEDS[FeatureScience]
{
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_GammaRayAstronomy
	}
}

// Configure
@PART[*]:HAS[#Tag_AstronomyExperiments[True]]:NEEDS[FeatureScience]
{
	MODULE
	{
		name = Experiment
		experiment_id = Spacelines_UVAstronomy
	}	
	MODULE
	{
		name = Experiment
		experiment_id = Spacelines_XrayAstronomy
	}
	MODULE
	{
		name = Experiment
		experiment_id = Spacelines_VisualAstronomy
	}
	MODULE
	{
		name = Experiment
		experiment_id = Spacelines_InfraredAstronomy
	}	
	MODULE
	{
		name = Configure
		title = Telescope Experiments
		slots = 1	
	
		SETUP
		{
			name = Ultraviolet Telescope
			desc = Installs a powerful ultraviolet telescope to make deep-space observations, particularly to help detect things like supermassive stars and supernovae. 
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_UVAstronomy
			}
		}		
		SETUP
		{
			name = X-Ray Telescope
			desc = Installs a powerful X-Ray telescope to observe emitters such as pulsars and black holes.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_XrayAstronomy
			}
		}	
		SETUP
		{
			name = Visual Telescope
			desc = Installs a massive visual telescope to take incredibly detailed images of objects both near and far, in the same way we would percieve them ourselves. This will likely be one of the biggest boons to science and public outreach we can get!
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_VisualAstronomy
			}
		}	
		SETUP
		{
			name = Infared Telescope
			desc = Installs a powerful infared telescope to observe the cosmos, using the fact that infared light can get through dust and gas clouds more easily to see never before seen objects in greater detail.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_InfraredAstronomy
			}
		}	
	}
}

// Setting Experiment Values
@PART[*]:HAS[#Tag_Spacelines_GammaRayAstronomy[True]]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_GammaRayAstronomy]] {
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/ResourceRates$

		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/size$
	}
}

@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Telecope?Experiments]]]:NEEDS[FeatureScience]
{
	@MODULE[Configure]:HAS[#title[Surveillance?Experiments]]
	{
		%reconfigure = false
		
		@SETUP:HAS[#name[Ultraviolet?Telescope]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/SetupCost$
		}
		@SETUP:HAS[#name[X-Ray?Telescope]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/SetupCost$
		}
		@SETUP:HAS[#name[Visual?Telescope]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/SetupCost$
		}
        @SETUP:HAS[#name[Infared?Telescope]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_InfraredAstronomy/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_InfraredAstronomy/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_InfraredAstronomy/SetupCost$
		}
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_UVAstronomy]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/ResourceRates$
		
		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/size$
	}
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_XrayAstronomy]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/ResourceRates$
		
		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/size$
	}
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisualAstronomy]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/ResourceRates$
		
		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/size$
	}
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_InfraredAstronomy]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_InfraredAstronomy/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_InfraredAstronomy/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_InfraredAstronomy/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_InfraredAstronomy/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_InfraredAstronomy/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_InfraredAstronomy/ResourceRates$
		
		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_InfraredAstronomy/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_InfraredAstronomy/size$
	}
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[#Tag_Spacelines_GammaRayAstronomy[True]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Telescope?Experiments]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment]
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

// ----------------------------------------------------------------------------
// Cleaning old science modules
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_XrayImaging]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_XrayImaging]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_UVscope]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_UVscope]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[infraredTelescope]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[infraredTelescope]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[scopeScan]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[scopeScan]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_orbitalScope]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_orbitalScope]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_TelescopeObservation]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_TelescopeObservation]] {}
}
