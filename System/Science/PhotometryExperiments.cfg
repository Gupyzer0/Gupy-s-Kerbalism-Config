// ============================================================================
// Photometry Experiments
// ============================================================================
// Modules being replaced:
// -----------------------
// + bd_photometer -> Spacelines_Photometer
// + bd_kepler -> Spacelines_ExoplanetaryTransitsObservations
// ----------------------------------------------------------------------------

// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_EXPERIMENT_VALUES:NEEDS[FeatureScience]
{
	%SPACELINES
	{
		Spacelines_Photometer{
			ECCost = 0.05
			size = 0.375
			value = 3
			duration = 900
			requirements = Sunlight 
			ResourceRates = 
			CrewRequirement = 
		}
        Spacelines_ExoplanetaryTransitsObservations{
			ECCost = 10
            size = 38000
			value = 700
			duration = 55225800
			requirements = 
			ResourceRates = 
			CrewRequirement = 
		}
	}
}

// ----------------------------------------------------------------------------
// Science Definitions 
// ----------------------------------------------------------------------------

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
	id = Spacelines_Photometer
	title = Photometer
	
	scienceCap = 3
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_Photometer/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_Photometer/size$
	@dataScale /= #$baseValue$

	RESULTS
	{
        default = You measure the brightness of the body below in the instrument's view.
        default = The photometer takes local brightness measurements.
        default = Albedo of the surface below is measured with the instrument.
	}

    KERBALISM_EXPERIMENT 
	{
        Situation = InSpaceLow
		Situation = InSpaceHigh
	}
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
	id = Spacelines_ExoplanetaryTransitsObservations
	title = Exoplanetary Transits Observations
	
	scienceCap = 50
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_ExoplanetaryTransitsObservations/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_ExoplanetaryTransitsObservations/size$
	@dataScale /= #$baseValue$

	RESULTS
	{
        default = The instrument detects a subtle dip in brightness of a distant star, light-years away. This indicates the discovery of a new exoplanet!
        default = The instrument measures a large change in brightness of an observed star, indicating either a large gas giant exoplanet or a binary planetary system have transited the star.
        default = Long, periodic instances of dimming are observed in a distant red giant. This is a rare discovery with data suggesting this system has had a large planetary collision, resulting in a large, scattered debris field forming a temporary asteroid belt around the star. 
        default = Collected data from this instrument has made an important discovery! Because of this instrument, scientists now can confirm that planets outnumber stars in our galaxy. While this seems inuitive, this could not be conclusively proven until several exoplanetary transits were observed. 
        default = A wide field of stars are being monitored by this instrument for exoplanet transits. Currently none are being observed but a transit could happen at any moment. Best keep your eyes peeled!
        default = A transit is observed around a Sun-like star of a possibly rocky planet. Could this be a habitable planet? Only future scientific investigations can tell.  
	}

    KERBALISM_EXPERIMENT 
	{
        Situation = InSpaceHigh
        BodyAllowed = Suns
	}
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------

// Tagging all parts
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_photometer]]]:NEEDS[FeatureScience] {
    %Tag_Spacelines_Photometer = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_kepler]]]:NEEDS[FeatureScience] {
	%Tag_Spacelines_ExoplanetaryTransitsObservations = True
}

// Experiment module
@PART[*]:HAS[#Tag_Spacelines_Photometer[True]]:NEEDS[FeatureScience] {
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_Photometer
	}
}

@PART[*]:HAS[#Tag_Spacelines_ExoplanetaryTransitsObservations[True]]:NEEDS[FeatureScience] {
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_ExoplanetaryTransitsObservations
	}
}

// Setting Experiment Values
@PART[*]:HAS[#Tag_Spacelines_Photometer[True]]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_Photometer]] {
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_Photometer/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_Photometer/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_Photometer/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_Photometer/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_Photometer/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_Photometer/ResourceRates$

		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_Photometer/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_Photometer/size$
	}
}

@PART[*]:HAS[#Tag_Spacelines_ExoplanetaryTransitsObservations[True]]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_ExoplanetaryTransitsObservations]] {
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_ExoplanetaryTransitsObservations/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_ExoplanetaryTransitsObservations/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_ExoplanetaryTransitsObservations/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_ExoplanetaryTransitsObservations/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_ExoplanetaryTransitsObservations/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_ExoplanetaryTransitsObservations/ResourceRates$

		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_ExoplanetaryTransitsObservations/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_ExoplanetaryTransitsObservations/size$
	}
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[#Tag_Spacelines_Photometer[True]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

@PART[*]:HAS[#Tag_Spacelines_ExoplanetaryTransitsObservations[True]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

// ----------------------------------------------------------------------------
// Cleaning old science modules
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_photometer]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
  !MODULE[*ModuleScience*]:HAS[#experimentID[bd_photometer]] {}
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_kepler]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
  !MODULE[*ModuleScience*]:HAS[#experimentID[bd_kepler]] {}
}
