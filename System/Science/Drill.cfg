// ============================================================================
// Drilling Experiment
// ============================================================================

// ----------------------------------------------------------------------------
// Science Definitions 
// ----------------------------------------------------------------------------
EXPERIMENT_DEFINITION
{
	id = Spacelines_drill
	title = Core Sample
	scienceCap = 14
	requireAtmosphere = False
	situationMask = 1
	biomeMask = 1
    baseValue = 34
	dataScale = 512
	@dataScale /= #$baseValue$
	
	RESULTS
	{
		default = The drill bores down into the ground, and a core sample is extracted.
		default = A core sample of bedrock is extracted from beneath the loose surface.
	}

    KERBALISM_EXPERIMENT
	{
		SampleMass = 0.025

		Situation = Surface@Biomes
	}
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------
// Experiment being replaced:
// -----------------------
// + bd_drill
// ----------------------------------------------------------------------------

// Creating experiment module on the modules with the experiments being replaced
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_drill]]]:NEEDS[FeatureScience] {
    MODULE
    {
        name = Experiment
        experiment_id = Spacelines_drill
    }
}

// ----------------------------------------------------------------------------
// Reconfiguration
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[Experiment]:HAS[#experiment_id[Spacelines_drill]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_drill]] {
        data_rate = 34
        @data_rate /= 10 // 10 secs
        ec_rate = 5
        allow_shrouded = false
    }
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------
// If there's an experiment with a DMOS module take their animations and insert them
// into the previously created Experiment module
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_drill]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_drill]&~anim_deploy[*]&~anim_loop[*]] {
        &anim_deploy = #$../MODULE[*ModuleScienceAnimate*]:HAS[#experimentID[bd_drill]]/animationName$
    }
}

// ----------------------------------------------------------------------------
// Cleaning replaced experiments
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_drill]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_drill]] {}
}
