// ============================================================================
// Telescope Experiments
// ============================================================================
// ----------------------------------------------------------------------------
// Stock infraredTelescope
// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_GROUP_SETTINGS:NEEDS[FeatureScience]
{
	%SPACELINES
	{   
        Spacelines_GammaRayAstronomy
		{
			ECCost = 2
			size = 5
			value = 15
			SetupMass = 
			SetupCost =			
			duration = 518400 // 6 days
			UnlockTech = 
			requirements = 
			ResourceRates = 
			CrewRequirement = 
		}

        Spacelines_UVAstronomy
        {
			ECCost = 17
			size = 70000
			value = 50
			duration = 78892380 // 5 years 
			SetupMass =
			SetupCost =
			UnlockTech = science6
			requirements = 
			ResourceRates = 
			CrewRequirement = 
		}

        Spacelines_XrayAstronomy
		{
			ECCost = 23
			size = 70000
			value = 120
			duration = 78892380 // 5 years
			SetupMass =
			SetupCost =
			UnlockTech = science7
			requirements =
			ResourceRates =
			CrewRequirement = 
		}

        Spacelines_VisualAstronomy
        {
            ECCost = 21
			size = 
			value = 240	
			SetupMass =
			SetupCost =			
			duration = 157784760 // 5 years
			UnlockTech = science8
			requirements = 
			ResourceRates =
			CrewRequirement = 
        }

        // Spacelines_InfraredAstronomy
        // {
		// 	ECCost = 30
		// 	size = 70000	
		// 	value = 12600
		// 	duration = 78892380 // 5 years
		// 	SetupMass =
		// 	SetupCost =
		// 	UnlockTech = science9
		// 	requirements =
		// 	ResourceRates =
		// 	CrewRequirement = 
		// }
	}
}

// ----------------------------------------------------------------------------
// Kerbalism Config
// ----------------------------------------------------------------------------

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_GammaRayAstronomy]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRayAstronomy/value$
	@dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRayAstronomy/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT 
	{
        Situation = Space
		BodyAllowed = HomeBody
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_UVAstronomy]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/value$
	@dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT 
	{
        Situation = Space
		BodyAllowed = HomeBody
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_XrayAstronomy]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/value$
	@dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT 
	{
        Situation = Space
		BodyAllowed = HomeBody
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_VisualAstronomy]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/value$
	@dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT 
	{
        Situation = Space
		BodyAllowed = HomeBody
	}
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[infraredTelescope]]]:NEEDS[FeatureScience] {
    %Tag_AstronomyExperiments = True
}

// Explorer 11 gamma ray astronomy experiment
@PART[*]:HAS[#Tag_Spacelines_GammaRayAstronomy[True]]:NEEDS[FeatureScience]
{
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_GammaRayAstronomy
	}
}

// Configure
@PART[*]:HAS[#Tag_AstronomyExperiments[True]]:NEEDS[FeatureScience]
{
	MODULE
	{
		name = Experiment
		experiment_id = Spacelines_UVAstronomy
	}	
	MODULE
	{
		name = Experiment
		experiment_id = Spacelines_XrayAstronomy
	}
	MODULE
	{
		name = Experiment
		experiment_id = Spacelines_VisualAstronomy
	}
	MODULE
	{
		name = Experiment
		experiment_id = infraredTelescope
	}	
	MODULE
	{
		name = Configure
		title = Telescope Experiments
		slots = 1	
	
		SETUP
		{
			name = Ultraviolet Telescope
			desc = Installs a powerful ultraviolet telescope to make deep-space observations, particularly to help detect things like supermassive stars and supernovae. 
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_UVAstronomy
			}
		}		
		SETUP
		{
			name = X-Ray Telescope
			desc = Installs a powerful X-Ray telescope to observe emitters such as pulsars and black holes.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_XrayAstronomy
			}
		}	
		SETUP
		{
			name = Visual Telescope
			desc = Installs a massive visual telescope to take incredibly detailed images of objects both near and far, in the same way we would percieve them ourselves. This will likely be one of the biggest boons to science and public outreach we can get!
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_VisualAstronomy
			}
		}	
		SETUP
		{
			name = Infared Telescope
			desc = Installs a powerful infared telescope to observe the cosmos, using the fact that infared light can get through dust and gas clouds more easily to see never before seen objects in greater detail.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = infraredTelescope
			}
		}	
	}
}

// Setting Experiment Values
@PART[*]:HAS[#Tag_Spacelines_GammaRayAstronomy[True]]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_GammaRayAstronomy]] {
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRayAstronomy/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRayAstronomy/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRayAstronomy/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRayAstronomy/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRayAstronomy/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRayAstronomy/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRayAstronomy/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GammaRayAstronomy/size$
	}
}

@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Telecope?Experiments]]]:NEEDS[FeatureScience]
{
	@MODULE[Configure]:HAS[#title[Telecope?Experiments]]
	{
		%reconfigure = false
		
		@SETUP:HAS[#name[Ultraviolet?Telescope]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/SetupCost$
		}
		@SETUP:HAS[#name[X-Ray?Telescope]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/SetupCost$
		}
		@SETUP:HAS[#name[Visual?Telescope]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/SetupCost$
		}
        @SETUP:HAS[#name[Infared?Telescope]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/STOCK/infraredTelescope/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/STOCK/infraredTelescope/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/STOCK/infraredTelescope/SetupCost$
		}
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_UVAstronomy]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/ResourceRates$
		
		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_UVAstronomy/size$
	}
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_XrayAstronomy]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/ResourceRates$
		
		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayAstronomy/size$
	}
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisualAstronomy]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/ResourceRates$
		
		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_VisualAstronomy/size$
	}
	@MODULE[Experiment]:HAS[#experiment_id[infraredTelescope]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/STOCK/infraredTelescope/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/STOCK/infraredTelescope/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/STOCK/infraredTelescope/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/STOCK/infraredTelescope/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/STOCK/infraredTelescope/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/STOCK/infraredTelescope/ResourceRates$
		
		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/STOCK/infraredTelescope/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/STOCK/infraredTelescope/size$
	}
}

//removing stock experiments to avoid duplicates. they get added through SETUPs, unlocked at stock tech.
@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Telescope?Experiments]]]:NEEDS[FeatureScience]
{
	!MODULE[Experiment]:HAS[#experiment_id[infraredTelescope]] {}
	
	// MODULE
	// {
	// 	name = Experiment
	// 	experiment_id = infraredTelescope
	// }
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[#Tag_Spacelines_GammaRayAstronomy[True],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Telescope?Experiments]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment]
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

// ----------------------------------------------------------------------------
// Cleaning old science modules
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[infraredTelescope]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[infraredTelescope]] {}
}
