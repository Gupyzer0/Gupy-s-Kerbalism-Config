// ============================================================================
// Telescope Experiments
// ============================================================================
// ----------------------------------------------------------------------------
// Stock infraredTelescope
// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_EXPERIMENT_VALUES:NEEDS[FeatureScience]
{
	%SPACELINES
	{   
		Spacelines_VisualAstronomy
        {
            ECCost = 2
			size = 115000
			value = 2400
			SetupMass =
			SetupCost =			
			duration = 157784760 // 5 years
			UnlockTech =
			requirements = 
			ResourceRates =
			CrewRequirement = 
        }

		Spacelines_UVAstronomy
        {
			ECCost = 2
			size = 76000
			value = 2400
			duration = 157784760 // 5 years
			SetupMass =
			SetupCost =
			UnlockTech = science6
			requirements = 
			ResourceRates = 
			CrewRequirement = 
		}

		Spacelines_XrayAstronomy
		{
			ECCost = 2
			size = 76000
			value = 200
			duration = 157784760 // 5 years
			SetupMass =
			SetupCost =
			UnlockTech = science7
			requirements =
			ResourceRates =
			CrewRequirement = 
		}  

        Spacelines_GammaRayAstronomy
		{
			ECCost = 2
			size = 76000
			value = 2400
			SetupMass = 
			SetupCost =			
			duration = 157784760 // 5 years
			UnlockTech = science7
			requirements = 
			ResourceRates = 
			CrewRequirement = 
		}

        infraredTelescope
        {
			ECCost = 2
			size = 76000	
			value = 1200
			duration = 157784760 // 5 years
			SetupMass =
			SetupCost =
			UnlockTech = science9
			requirements =
			ResourceRates =
			CrewRequirement = 
		}
	}
}

// ----------------------------------------------------------------------------
// Kerbalism Config
// ----------------------------------------------------------------------------
@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_VisualAstronomy]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_VisualAstronomy/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_VisualAstronomy/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT 
	{
        Situation = Space
		BodyAllowed = HomeBody
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_UVAstronomy]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_UVAstronomy/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_UVAstronomy/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT 
	{
        Situation = Space
		BodyAllowed = HomeBody
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_XrayAstronomy]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_XrayAstronomy/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_XrayAstronomy/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT 
	{
        Situation = Space
		BodyAllowed = HomeBody
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_GammaRayAstronomy]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT 
	{
        Situation = Space
		BodyAllowed = HomeBody
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[infraredTelescope]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/infraredTelescope/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/infraredTelescope/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT 
	{
        Situation = Space
		BodyAllowed = HomeBody
	}
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[infraredTelescope]]]:NEEDS[FeatureScience] {
    %Tag_AstronomyExperiments = True
}

// Configure
@PART[*]:HAS[#Tag_AstronomyExperiments[True]]:NEEDS[FeatureScience]
{
	MODULE
	{
		name = Experiment
		experiment_id = Spacelines_VisualAstronomy
	}
	MODULE
	{
		name = Experiment
		experiment_id = Spacelines_UVAstronomy
	}
	MODULE
	{
		name = Experiment
		experiment_id = Spacelines_XrayAstronomy
	}
	MODULE
	{
		name = Experiment
		experiment_id = Spacelines_GammaRayAstronomy
	}	
	MODULE
	{
		name = Experiment
		experiment_id = infraredTelescope
	}	
	MODULE
	{
		name = Configure
		title = Telescope Experiments
		slots = 1	

		SETUP
		{
			name = Visual Telescope
			desc = Installs a massive visual telescope to take incredibly detailed images of objects both near and far, in the same way we would percieve them ourselves. This will likely be one of the biggest boons to science and public outreach we can get!
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_VisualAstronomy
			}
		}	
		SETUP
		{
			name = Ultraviolet Telescope
			desc = Installs a powerful ultraviolet telescope to make deep-space observations, particularly to help detect things like supermassive stars and supernovae. 
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_UVAstronomy
			}
		}
		SETUP
		{
			name = X-Ray Telescope
			desc = Installs a powerful X-Ray telescope to observe emitters such as pulsars and black holes.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_XrayAstronomy
			}
		}
		SETUP
		{
			name = Gamma Ray Telescope
			desc = Installs a Gamma-Ray telescope used for detection and study gamma rays, the most energetic form of light, from celestial sources.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_GammaRayAstronomy
			}
		}
		SETUP
		{
			name = Infrared Telescope
			desc = Installs a powerful infrared telescope to observe the cosmos, using the fact that infrared light can get through dust and gas clouds more easily to see never before seen objects in greater detail.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = infraredTelescope
			}
		}	
	}
}

// Setting Experiment Values

@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Telescope?Experiments]]]:NEEDS[FeatureScience]
{
	@MODULE[Configure]:HAS[#title[Telescope?Experiments]]
	{
		%reconfigure = false
		
		@SETUP:HAS[#name[Ultraviolet?Telescope]]
		{
			%tech = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_UVAstronomy/UnlockTech$
			%mass = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_UVAstronomy/SetupMass$
			%cost = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_UVAstronomy/SetupCost$
		}
		@SETUP:HAS[#name[X-Ray?Telescope]]
		{
			%tech = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_XrayAstronomy/UnlockTech$
			%mass = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_XrayAstronomy/SetupMass$
			%cost = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_XrayAstronomy/SetupCost$
		}
		@SETUP:HAS[#name[Visual?Telescope]]
		{
			%tech = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_VisualAstronomy/UnlockTech$
			%mass = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_VisualAstronomy/SetupMass$
			%cost = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_VisualAstronomy/SetupCost$
		}
        @SETUP:HAS[#name[Infared?Telescope]]
		{
			%tech = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/infraredTelescope/UnlockTech$
			%mass = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/infraredTelescope/SetupMass$
			%cost = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/infraredTelescope/SetupCost$
		}
		@SETUP:HAS[#name[Gamma?Ray?Telescope]]
		{
			%tech = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/UnlockTech$
			%mass = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/SetupMass$
			%cost = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/SetupCost$
		}
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_UVAstronomy]]
	{
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_UVAstronomy/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_UVAstronomy/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_UVAstronomy/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_UVAstronomy/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_UVAstronomy/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_UVAstronomy/ResourceRates$
		
		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_UVAstronomy/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_UVAstronomy/size$
	}
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_XrayAstronomy]]
	{
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_XrayAstronomy/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_XrayAstronomy/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_XrayAstronomy/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_XrayAstronomy/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_XrayAstronomy/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_XrayAstronomy/ResourceRates$
		
		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_XrayAstronomy/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_XrayAstronomy/size$
	}
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_VisualAstronomy]]
	{
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_VisualAstronomy/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_VisualAstronomy/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_VisualAstronomy/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_VisualAstronomy/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_VisualAstronomy/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_VisualAstronomy/ResourceRates$
		
		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_VisualAstronomy/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_VisualAstronomy/size$
	}
	@MODULE[Experiment]:HAS[#experiment_id[infraredTelescope]]
	{
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/infraredTelescope/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/infraredTelescope/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/infraredTelescope/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/infraredTelescope/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/infraredTelescope/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/infraredTelescope/ResourceRates$
		
		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/infraredTelescope/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/infraredTelescope/size$
	}
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_GammaRayAstronomy]]
	{
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/ResourceRates$
		
		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_GammaRayAstronomy/size$
	}
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Telescope?Experiments]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment]
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

// ----------------------------------------------------------------------------
// Cleaning old science modules
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[infraredTelescope]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[infraredTelescope]] {}
}
