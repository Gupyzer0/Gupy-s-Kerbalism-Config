// ============================================================================
// Cosmic Rays Experiments
// ============================================================================
// + Kerbalism: geigerCounter
// ----------------------------------------------------------------------------

// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_GROUP_SETTINGS:NEEDS[FeatureScience]
{
	%SPACELINES
	{
		Spacelines_CosmicRay1
		{
			ECCost = 0.0001
			size = 0.25
			value = 2
			duration = 86400 // 1 day
			requirements =
			ResourceRates =
			SetupMass = 0.005
			SetupCost = 400
			UnlockTech = construction1
			CrewRequirement =
		}
		Spacelines_CosmicRay2
		{
			ECCost = 0.002
			size = 0.25
			value = 3.5
			SetupMass =
			SetupCost =								
			duration = 648000 // 7.5 days
			UnlockTech = science2
			requirements =
			ResourceRates =
			CrewRequirement = 
		}
		Spacelines_CosmicRay3
		{
			ECCost = 0.0005
			size = 0.25
			value = 5
			SetupMass =
			SetupCost =								
			duration = 648000 // 7.5 days
			UnlockTech = science3
			requirements =
			ResourceRates =
			CrewRequirement = 
		}
		Spacelines_CosmicRay4
		{
			ECCost = 0.05
			size = 4.5
			value = 5
			SetupMass =
			SetupCost =								
			duration = 648000 // 7.5 days
			UnlockTech = science4
			requirements =
			ResourceRates =
			CrewRequirement = 
		}
	}
}

// ----------------------------------------------------------------------------
// Kerbalism Config
// ----------------------------------------------------------------------------

// Geiger Muller Counter
@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_CosmicRay1]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay1/value$
	@dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay1/size$
	@dataScale /= #$baseValue$

	%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay1/duration$

	KERBALISM_EXPERIMENT
	{
		VirtualBiome = NoBiome
		VirtualBiome = InnerBelt
		VirtualBiome = OuterBelt
		VirtualBiome = Magnetosphere
		VirtualBiome = Storm
		VirtualBiome = Interstellar
	
		Situation = FlyingLow
		Situation = FlyingHigh
		Situation = Space@VirtualBiomes
	}
}

// Scintillation Counter Cosmic Ray Telescopes
@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_CosmicRay2]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay2/value$
	@dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay2/size$
	@dataScale /= #$baseValue$

	%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay2/duration$

	KERBALISM_EXPERIMENT
	{
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0

        VirtualBiome = NoBiome
		VirtualBiome = Magnetosphere
        VirtualBiome = Storm
        VirtualBiome = OuterBelt
        VirtualBiome = InnerBelt
        VirtualBiome = Interstellar

		Situation = Space@VirtualBiomes

		IncludeExperiment = Spacelines_CosmicRay1
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_CosmicRay3]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay3/value$
	@dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay3/size$
	@dataScale /= #$baseValue$

	%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay3/duration$

	KERBALISM_EXPERIMENT
	{
		VirtualBiome = NoBiome
		VirtualBiome = InnerBelt
		VirtualBiome = OuterBelt
		VirtualBiome = Magnetosphere
		VirtualBiome = Storm
		VirtualBiome = Interstellar
		
		Situation = Space@VirtualBiomes
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_CosmicRay4]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay4/value$
	@dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay4/size$
	@dataScale /= #$baseValue$

	%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay4/duration$

	KERBALISM_EXPERIMENT
	{
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0
	
		VirtualBiome = NoBiome
		VirtualBiome = Magnetosphere
        VirtualBiome = Storm
        VirtualBiome = OuterBelt
        VirtualBiome = InnerBelt
        VirtualBiome = Interstellar

        Situation = Space@VirtualBiomes
	}
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[geigerCounter]]]:NEEDS[FeatureScience] {
	%Tag_Spacelines_CosmicRay_Experiment = True
}

// Creating Configure
@PART[*]:HAS[#Tag_Spacelines_CosmicRay_Experiment[True]]:NEEDS[FeatureScience]
{
	MODULE
	{
		name = Sensor
		type = radiation
		pin = needle
	}
	
    MODULE
    {
        name = Experiment
        experiment_id = Spacelines_CosmicRay1
    }

    MODULE
    {
        name = Experiment
        experiment_id = Spacelines_CosmicRay2
    }

	MODULE
    {
        name = Experiment
        experiment_id = Spacelines_CosmicRay3
    }

	MODULE
    {
        name = Experiment
        experiment_id = Spacelines_CosmicRay4
    }
    
    MODULE
	{
		name = Configure
		title = Radiation Experiments
		slots = 1
		reconfigure = false

        SETUP
        {
            name = Geiger Muller Counter
            desc = Based on the Geiger-Muller Counters used on many spacecraft.

            MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_CosmicRay1
			}
        }

        SETUP
        {
            name = Scintillation Counter
            desc = Based on the Scintillation Counter Cosmic Ray Telescopes used on many spacecraft

            MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_CosmicRay2
			}
        }

		SETUP
        {
            name = Cherenkov Detector
            desc = A Cherenkov detector used for the categorization of high-energy particles from solar wind and cosmic rays, particularly gamma rays from beyond the solar system.

            MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_CosmicRay3
			}
        }

		SETUP
        {
            name = Ionization Chamber
            desc = An ionization chamber is a device that measures and detects ionizing radiation, such as X-rays, alpha particles, beta particles, and gamma rays.

            MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_CosmicRay4
			}
        }
    }
}

// Experiments values
@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Radiation?Experiments]]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@MODULE[Configure]:HAS[#title[Radiation?Experiments]]
	{
		@SETUP:HAS[#name[Geiger?Muller?Counter]]
		{
			cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay1/SetupCost
            mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay1/SetupMass
            tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay1/UnlockTech
		}

		@SETUP:HAS[#name[Scintillation?Counter]]
		{
			cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay2/SetupCost
            mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay2/SetupMass
            tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay2/UnlockTech
		}

		@SETUP:HAS[#name[Cherenkov?Detector]]
		{
			cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay3/SetupCost
            mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay3/SetupMass
            tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay3/UnlockTech
		}

		@SETUP:HAS[#name[Ionization?Chamber]]
		{
			cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay4/SetupCost
            mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay4/SetupMass
            tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay4/UnlockTech
		}

	}
		
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_CosmicRay1]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay1/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay1/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay1/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay1/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay1/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay1/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay1/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay1/size$
	}

	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_CosmicRay2]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay2/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay2/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay2/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay2/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay2/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay2/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay2/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay2/size$
	}

	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_CosmicRay3]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay3/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay3/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay3/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay3/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay3/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay3/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay3/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay3/size$
	}

	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_CosmicRay4]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay4/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay4/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay4/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay4/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay4/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay4/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay4/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay4/size$
	}
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Radiation?Experiments]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment]
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}
