// ============================================================================
// Underwater Experiments
// ============================================================================

// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_GROUP_SETTINGS:NEEDS[FeatureScience]
{
	%SPACELINES
	{   
		Spacelines_SALT										//sample, 150m depth requirements
		{
			ECCost = 6.82							
			size = 12947
			value = 22
			duration = 180
			SetupMass = 0.005
			SetupCost = 5370
			UnlockTech = start
			requirements = AltitudeMax:-100
			CrewRequirement = 
			ResourceRates =
		}
		
		Spacelines_H2O											//replacement for stock surface sample (it could be done splashed before, made no sense)
		{
			ECCost = 14.02							
			size = 9597
			value = 24								// 
			duration = 35							//  35 seconds. really quick.
			SetupMass = 0.005
			SetupCost = 3900
			UnlockTech = start
			requirements = AltitudeMin:-25	//as it's a replacement, it should be close to surface. ocean requirement forces you underwater, so 25m buffer.
			CrewRequirement = 
			ResourceRates =
		}
    }
}

// ----------------------------------------------------------------------------
// Science Definitions 
// ----------------------------------------------------------------------------

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
	id = Spacelines_SALT
	title = SALT
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_SALT/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_SALT/size$
	@dataScale /= #$baseValue$
	scienceCap = 14
	  
  	KERBALISM_EXPERIMENT
	{
    	Situation = SrfSplashed@Biomes
		SampleMass = 0.0188 
	}
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
	id = Spacelines_H2O
	title = H2O
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_H2O/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_H2O/size$
	@dataScale /= #$baseValue$
	scienceCap = 30
  
  	KERBALISM_EXPERIMENT
	{
    	Situation = SrfSplashed@Biomes
		SampleMass = 0.0035
	}
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------

// Tagging all atmospheric experiments parts
+PART[sensorAtmosphere]:FIRST
{
	@name = spacelines_underwater_exp
	@title = Underwater Experiments Package // Uhmmm get a better title???
	%Tag_Spacelines_Underwater = True
}

// Creating configure module for all tagged parts
@PART[*]:HAS[#Tag_Spacelines_Underwater]:NEEDS[FeatureScience] {

	MODULE
	{
		name = Experiment
		experiment_id = Spacelines_SALT
	}					
	MODULE
	{
		name = Experiment
		experiment_id = Spacelines_H2O
	}

	MODULE
	{
		name = Configure
		title = Underwater Science
		slots = 1

		UPGRADES
		{
			UPGRADE
			{
				name__ = Underwater-Upgrade1
				techRequired__ = start
				slots = 2
			}
		}

		SETUP
		{
			name = None
			desc = Empty slot for mass and cost savings, should you not require any instruments installed.
		}
		SETUP
		{
			name = SALT
			desc = Saline Authenticity Licking Test: Kerbal Scientists assure us this test is very much scientific.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = kerbalism_SALT
			}
		} 	
		SETUP
		{
			name = H2O
			desc = Hydro-di-Oxyl Observation: This sample has been shortened to H2O.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = kerbalism_H2O
			}
		}
	}
}

@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Underwater?Science]]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@MODULE[Configure]:HAS[#title[Underwater?Science]]
	{
		@SETUP:HAS[#name[SALT]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_SALT/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_SALT/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_SALT/SetupCost$
		}
		
		@SETUP:HAS[#name[H2O]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_H2O/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_H2O/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_H2O/SetupCost$
		}
	}
	
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_SALT]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_SALT/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_SALT/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_SALT/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_SALT/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_SALT/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_SALT/ResourceRates$
		%sample_collecting = True
		%allow_shrouded = False
	}

	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_H2O]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_H2O/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_H2O/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_H2O/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_H2O/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_H2O/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_H2O/ResourceRates$
		%sample_collecting = True
		%allow_shrouded = False
	}
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Underwater?Science]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment]
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}
