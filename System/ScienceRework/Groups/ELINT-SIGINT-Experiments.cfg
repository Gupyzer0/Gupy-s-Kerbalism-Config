// ============================================================================
// ELINT and SIGINT experiments
// ============================================================================
// Modules being replaced:
// -----------------------

// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_EXPERIMENT_VALUES:NEEDS[FeatureScience]
{
	%SPACELINES
	{
        Spacelines_ELINT
		{
			ECCost = 1	
			size = 5700
			value = 55
			SetupMass =
			SetupCost =			
			duration = 15552000 // 180 days
			UnlockTech = 
			requirements =
			ResourceRates =
			CrewRequirement =
		}
		Spacelines_SIGINT
		{
			ECCost = 5	
			size = 77000
			value = 2800 
			SetupMass =
			SetupCost =			
			duration = 181440000 // 2100 days
			UnlockTech = 
			requirements =
			ResourceRates =
			CrewRequirement =
		}
    }
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
	id = Spacelines_ELINT
	title = ELINT
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_ELINT/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_ELINT/size$
	@dataScale /= #$baseValue$
	scienceCap = 55
	requireAtmosphere = False
	situationMask = 48 // in space low, in space high
	biomeMask = 16 // orbiting surveillance should be like mapping, different locations might lead to different data

    RESULTS
    {
        default = A complete radio surveillance sweep of this planet is completed.
    }

    KERBALISM_EXPERIMENT 
	{
		VirtualBiome = NorthernHemisphere
		VirtualBiome = SouthernHemisphere
		
		Situation = Space@VirtualBiomes
		
		BodyAllowed = HomeBody
	}
}

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
	id = Spacelines_SIGINT
	title = SIGINT
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_SIGINT/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_SIGINT/size$
	@dataScale /= #$baseValue$
	scienceCap = 2800
	requireAtmosphere = False
	situationMask = 48 // in space low, in space high
	biomeMask = 16 // orbiting surveillance should be like mapping, different locations might lead to different data

    RESULTS
    {
        default = Significant levels of radio chatter are picked up, a surprising amount of which seems to be focused on spacecraft communications.
    }

    KERBALISM_EXPERIMENT 
	{
		VirtualBiome = NorthernHemisphere
		VirtualBiome = SouthernHemisphere
		
		Situation = Space@VirtualBiomes
		
		BodyAllowed = HomeBody
	}
}


// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[dmSIGINT]]]:NEEDS[FeatureScience] {
    %Tag_Spacelines_SIGINT = True
}

// Experiment module
@PART[*]:HAS[#Tag_Spacelines_ELINT[True]]:NEEDS[FeatureScience] {
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_ELINT
	}
}

@PART[*]:HAS[#Tag_Spacelines_SIGINT[True]]:NEEDS[FeatureScience] {
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_SIGINT
	}
}

// Setting Experiment Values
@PART[*]:HAS[#Tag_Spacelines_ELINT[True]]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_ELINT]] {
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_ELINT/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_ELINT/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_ELINT/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_ELINT/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_ELINT/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_ELINT/ResourceRates$

		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_ELINT/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_ELINT/size$
	}
}

@PART[*]:HAS[#Tag_Spacelines_SIGINT[True]]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_SIGINT]] {
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SIGINT/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SIGINT/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SIGINT/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SIGINT/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SIGINT/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SIGINT/ResourceRates$

		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SIGINT/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SIGINT/size$
	}
}


// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[#Tag_Spacelines_ELINT[True]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

@PART[*]:HAS[#Tag_Spacelines_SIGINT[True]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}
