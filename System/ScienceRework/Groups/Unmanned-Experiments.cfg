// Probe experiments

@KERBALISM_GROUP_SETTINGS:NEEDS[FeatureScience]
{
	UNMANNED_EXPERIMENTS
	{
		BaseSlots = 1
		UpgradeTech = science2
		UpgradedSlots = 2
		UpgradeEntryCost = 20000

		TelemetryReport								//All situations, biomes-everywhere except orbit, both high and low.
		{
			ECCost = 0.0001
			size = 0.75
			value = 2								// super low value. i assume reasons are obvious.
			duration = 30							//
			SetupMass = 0.0
			SetupCost = 100
			UnlockTech = start
			requirements =
			CrewRequirement =
			ResourceRates =
		}

		Thermometer									//Stock Temp Scan. Other parameters are configured in StockExperiments.cfg
		{	
			ECCost = 0.0001
			size = 0.25
			value = 2
			duration = 10										// values are the same as stock instrument.
			SetupMass = 0
			SetupCost = 900
			UnlockTech = start
			CrewRequirement =
			requirements =
			CrewRequirement =
			ResourceRates =
		}

		ReEntryTesting
		{
			ECCost = 0.0001
			size = 0.25
			value = 3
			duration = 600
			SetupMass = 0.005
			SetupCost = 400
			UnlockTech = construction1
			CrewRequirement =
			requirements =
			CrewRequirement =
			ResourceRates =
		}
	}
}

// ----------------------------------------------------------------------------
// Science Definitions 
// ----------------------------------------------------------------------------

EXPERIMENT_DEFINITION:NEEDS[FeatureScience]
{
	id = kerbalism_TELEMETRY
	title = Telemetry Report
	baseValue = 2
	scienceCap = 2
	dataScale = 1
  
  	KERBALISM_EXPERIMENT
	{
		Situation = SrfLanded@Biomes
		Situation = SrfSplashed@Biomes
		Situation = FlyingLow@Biomes
		Situation = FlyingHigh@Biomes
		Situation = InSpaceLow
		Situation = InSpaceHigh
	}
}

EXPERIMENT_DEFINITION
{
	id = ReEntryTesting
	title = Re-Entry Testing

	baseValue = 3
	scienceCap = 3
	dataScale = 1

	RESULTS
	{
		default = It seems like our theories were correct. Things do in fact get quite toasty when they slam into the atmosphere on the way down!
	}

    	KERBALISM_EXPERIMENT 
	{	
		VirtualBiome = Reentry
		Situation = FlyingHigh@VirtualBiomes
		BodyAllowed = HomeBody
	}
}



// ============================================================================
// Patching the Experiment Definitions, according to the values in KERBALISM_GROUP_SETTINGS
// ============================================================================

@EXPERIMENT_DEFINITION:HAS[#id[kerbalism_TELEMETRY]]:NEEDS[FeatureScience]:FOR[zzzKerbalismDefault]
{
	@baseValue = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/TelemetryReport/value$
	@dataScale = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/TelemetryReport/size$
	@dataScale /= #$baseValue$
}

@EXPERIMENT_DEFINITION:HAS[#id[ReEntryTesting]]:NEEDS[FeatureScience]:FOR[zzzKerbalismDefault]
{
    @baseValue = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/ReEntryTesting/value$
	@dataScale = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/ReEntryTesting/size$
	@dataScale /= #$baseValue$
}

// Only Probes. "Tag_Exclude_Unmanned_Exp" used in guidance computers, station parts, etc.
@PART[*]:HAS[@MODULE[ModuleCommand]:HAS[#minimumCrew[0]]]
{
	MODULE
	{
		name = Configure
		title = Unmanned Experiments
	}
}

@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Unmanned?Experiments]]]:NEEDS[FeatureScience]
{
	MODULE
	{
		name = Experiment
		experiment_id = kerbalism_TELEMETRY
	}
	MODULE
	{
		name = Experiment
		experiment_id = temperatureScan
	}
	MODULE
	{
		name = Experiment
		experiment_id = ReEntryTesting
	}

	@MODULE[Configure]:HAS[#title[Unmanned?Experiments]]
	{
		SETUP
		{
			name = None
			desc = Empty slot for mass and cost savings, should you not require any experiments installed.
		}
		SETUP
		{
			name = Telemetry Report
			desc = Allows the probe core to send back telemetry data.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = kerbalism_TELEMETRY
			}
		}
		SETUP
		{
			name = 2HOT Thermometer
			desc = Installs the 2HOT Thermometer on the Science Instrument Unit, allowing you to perform temperature scans.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = temperatureScan
			}
		}
		SETUP
		{
			name = Re-entry Testing
			desc = Collect data about the conditions of re-entry.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = ReEntryTesting
			}
		}
	}
}

// ============================================================================
// The experiments were just added above, but not configured. This section takes care of that
// ============================================================================
@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Unmanned?Experiments]]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@MODULE[Configure]:HAS[#title[Unmanned?Experiments]]
	{
		@slots = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/BaseSlots$
		UPGRADES
		{
			UPGRADE
			{
				name__ = Unmanned-Upgrade1
				techRequired__ = #$../../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/UpgradeTech$
				slots = #$../../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/UpgradedSlots$
			}
		}
	
		@SETUP:HAS[#name[2HOT?Thermometer]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Thermometer/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Thermometer/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Thermometer/SetupCost$
		}

		@SETUP:HAS[#name[Telemetry?Report]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/TelemetryReport/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/TelemetryReport/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/TelemetryReport/SetupCost$
		}

		@SETUP:HAS[#name[Re-entry?Testing]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/ReEntryTesting/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/ReEntryTesting/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/ReEntryTesting/SetupCost$
		}
	}

	@MODULE[Experiment]:HAS[#experiment_id[kerbalism_TELEMETRY]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/TelemetryReport/ECCost$
		%requires = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/TelemetryReport/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/TelemetryReport/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/TelemetryReport/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/TelemetryReport/ResourceRates$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/TelemetryReport/CrewRequirement$
	}	

	@MODULE[Experiment]:HAS[#experiment_id[temperatureScan]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Thermometer/ECCost$
		%requires = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Thermometer/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Thermometer/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Thermometer/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Thermometer/ResourceRates$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Thermometer/CrewRequirement$
	}

	@MODULE[Experiment]:HAS[#experiment_id[ReEntryTesting]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/ReEntryTesting/ECCost$
		%requires = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/ReEntryTesting/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/ReEntryTesting/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/ReEntryTesting/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/ReEntryTesting/ResourceRates$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/ReEntryTesting/CrewRequirement$
	}
}
