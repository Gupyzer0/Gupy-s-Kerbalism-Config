// Probe experiments

@KERBALISM_GROUP_SETTINGS:NEEDS[FeatureScience]
{
	UNMANNED_EXPERIMENTS
	{
		BaseSlots = 1
		UpgradeTech = science2
		UpgradedSlots = 2
		UpgradeEntryCost = 20000

		Spacelines_Telemetry								//All situations, biomes-everywhere except orbit, both high and low.
		{
			ECCost = 0.0001
			size = 0.75
			value = 2								// super low value. i assume reasons are obvious.
			duration = 30							//
			SetupMass = 0.0
			SetupCost = 100
			UnlockTech = start
			requirements =
			CrewRequirement =
			ResourceRates =
		}

		Spacelines_ReEntryTesting
		{
			ECCost = 0.0001
			size = 0.25
			value = 3
			duration = 600
			SetupMass = 0.005
			SetupCost = 400
			UnlockTech = construction1
			CrewRequirement =
			requirements =
			CrewRequirement =
			ResourceRates =
		}
	}
}

// ============================================================================
// Kerbalism Config
// ============================================================================

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_Telemetry]]:NEEDS[FeatureScience]:FOR[zzzKerbalismDefault]
{
	@baseValue = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_Telemetry/value$
	@dataScale = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_Telemetry/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
	{
		Situation = SrfLanded@Biomes
		Situation = SrfSplashed@Biomes
		Situation = FlyingLow@Biomes
		Situation = FlyingHigh@Biomes
		Situation = InSpaceLow
		Situation = InSpaceHigh
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_ReEntryTesting]]:NEEDS[FeatureScience]:FOR[zzzKerbalismDefault]
{
    @baseValue = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_ReEntryTesting/value$
	@dataScale = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_ReEntryTesting/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT 
	{	
		VirtualBiome = Reentry
		Situation = FlyingHigh@VirtualBiomes
		BodyAllowed = HomeBody
	}
}

// Creating config, only for Probes.
@PART[*]:HAS[@MODULE[ModuleCommand]:HAS[#minimumCrew[0]]]
{
	MODULE
	{
		name = Configure
		title = Unmanned Experiments
	}
}

@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Unmanned?Experiments]]]:NEEDS[FeatureScience]
{
	MODULE
	{
		name = Experiment
		experiment_id = Spacelines_Telemetry
	}
	MODULE
	{
		name = Experiment
		experiment_id = Spacelines_TemperatureScan
	}
	MODULE
	{
		name = Experiment
		experiment_id = Spacelines_ReEntryTesting
	}

	@MODULE[Configure]:HAS[#title[Unmanned?Experiments]]
	{
		SETUP
		{
			name = None
			desc = Empty slot for mass and cost savings, should you not require any experiments installed.
		}
		SETUP
		{
			name = Telemetry Report
			desc = Allows the probe core to send back telemetry data.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_Telemetry
			}
		}
		SETUP
		{
			name = Thermometer
			desc = Installs the 2HOT Thermometer on the Science Instrument Unit, allowing you to perform temperature scans.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_TemperatureScan
			}
		}
		SETUP
		{
			name = Re-entry Testing
			desc = Collect data about the conditions of re-entry.
			MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_ReEntryTesting
			}
		}
	}
}

// ============================================================================
// The experiments were just added above, but not configured. This section takes care of that
// ============================================================================
@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Unmanned?Experiments]]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@MODULE[Configure]:HAS[#title[Unmanned?Experiments]]
	{
		@slots = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/BaseSlots$
		UPGRADES
		{
			UPGRADE
			{
				name__ = Unmanned-Upgrade1
				techRequired__ = #$../../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/UpgradeTech$
				slots = #$../../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/UpgradedSlots$
			}
		}
	
		@SETUP:HAS[#name[2HOT?Thermometer]]
		{
			%tech = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_TemperatureScan/UnlockTech$
			%mass = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_TemperatureScan/SetupMass$
			%cost = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_TemperatureScan/SetupCost$
		}

		@SETUP:HAS[#name[Telemetry?Report]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_Telemetry/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_Telemetry/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_Telemetry/SetupCost$
		}

		@SETUP:HAS[#name[Re-entry?Testing]]
		{
			%tech = #$../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_ReEntryTesting/UnlockTech$
			%mass = #$../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_ReEntryTesting/SetupMass$
			%cost = #$../../@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_ReEntryTesting/SetupCost$
		}
	}

	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_Telemetry]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_Telemetry/ECCost$
		%requires = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_Telemetry/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_Telemetry/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_Telemetry/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_Telemetry/ResourceRates$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_Telemetry/CrewRequirement$
	}	

	@MODULE[Experiment]:HAS[#experiment_id[temperatureScan]]
	{
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_TemperatureScan/ECCost$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_TemperatureScan/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_TemperatureScan/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_TemperatureScan/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_TemperatureScan/ResourceRates$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_TemperatureScan/CrewRequirement$
	}

	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_ReEntryTesting]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_ReEntryTesting/ECCost$
		%requires = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_ReEntryTesting/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_ReEntryTesting/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_ReEntryTesting/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_ReEntryTesting/ResourceRates$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/Spacelines_ReEntryTesting/CrewRequirement$
	}
}

// ----------------------------------------------------------------------------
// Upgrades
// ----------------------------------------------------------------------------
PARTUPGRADE:NEEDS[FeatureScience]
{
  name = Unmanned-Upgrade1
  partIcon = kerbalism-geigercounter
  title = Unmanned Experiments Slot Upgrade
  manufacturer = A&D Aerospace
  description = Adds an additional experiment slot to Probes.
}
@PARTUPGRADE[Unmanned-Upgrade1]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	%techRequired = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/UpgradeTech$
	%entryCost = #$@KERBALISM_GROUP_SETTINGS/UNMANNED_EXPERIMENTS/UpgradeEntryCost$
}
