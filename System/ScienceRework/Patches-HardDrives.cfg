@KERBALISM_HDD_SIZES:NEEDS[FeatureScience]
{
	Upgrades
	{
		DATA_CAPACITY_MULTIPLIERS
		{
			FirstUpgrade = 2
			FirstUpgradeTech = science2
			FirstUpgradeEntryCost = 840
			SecondUpgrade = 8
			SecondUpgradeTech = science4
			SecondUpgradeEntryCost = 6800
			ThirdUpgrade = 128
			ThirdUpgradeTech = science6
			ThirdUpgradeEntryCost = 18200
			FourthUpgrade = 1024
			FourthUpgradeTech = science8 // T8
			FourthUpgradeEntryCost = 56400
		}

		SAMPLE_CAPACITY_MULTIPLIERS
		{
			FirstUpgrade = 3
			FirstUpgradeTech = science2
			FirstUpgradeEntryCost = 12500
			SecondUpgrade = 6
			SecondUpgradeTech = science4
			SecondUpgradeEntryCost = 25000
			ThirdUpgrade = 12
			ThirdUpgradeTech = science6
			ThirdUpgradeEntryCost = 35000
		}
	}
	
	Tier1
	{
		data = 1
		samples = 0
	}

	Tier2
	{
		data = 2
		samples = 0
	}

	Tier3
	{
		data = 4
		samples = 0
	}

	Tier4
	{
		data = 8
		samples = 0
	}

	Tier5
	{
		data = 16
		samples = 0
	}

	Tier6
	{
		data = 32
		samples = 0
	}

	Tier7
	{
		data = 64
		samples = 0
	}

	Tier8
	{
		data = 128
		samples = 0
	}

	Tier9
	{
		data = 256
		samples = 0
	}

	TierX
	{
		data = 512
		samples = 0
	}

	ScienceLabs										//snowflake
	{
		data = 2560
		samples = 44
	}

	RoveMate										//T6
	{
		data = 32
		samples = 6									//only probe that can store samples
	}

	// EVAs can't be upgraded, so we give them unlimited space.
	// a) they need the capacity to move data between drives
	// b) they can't use it in any other way, except for EVA reports and surface
	// samples. So no matter how much they get here, it won't be OP
	// c) you can't use EVAs to store data for very long, after 8h they're dead
	EVAKerbals
	{
		data = -1
		samples = -1
	}

	ScienceBox										//snowflake
	{
		data = 0
		samples = 9
	}

	PRIVATE_DRIVES									//this is internal storage for samples.
	{												//It can only store samples for the experiment it's attached to
		MysteryGoo
		{
			data = 0
			samples = 1
			SampleReservoirUpgrade = 3				//multiplier (this is the number of times it can run before needing a reset)
			UpgradeTech = science4
			UpgradeEntryCost = 1600
		}

		MaterialsBay
		{
			data = 0
			samples = 4								//this has to be equal to the sample size.
			SampleReservoirUpgrade = 2				//multiplier (this is the number of times it can run before needing a reset)
			UpgradeTech = science6
			UpgradeEntryCost = 6800
		}
	}
}

// ----------------------------------------------------------------------------
// Remove stock science data containers, add hard-drives/sample containers instead
// Setting default drive sizes for all parts, even modded ones
// modded parts will need separate tweaks in their own configs
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[ModuleScienceContainer]]:NEEDS[FeatureScience]
{
	!MODULE[ModuleScienceContainer] {}
}

// Every Command Module gets this basic hard drive
@PART[*]:HAS[@MODULE[ModuleCommand]]:NEEDS[FeatureScience]
{
	MODULE
	{
		name = HardDrive
		title = Command Module Storage
		dataCapacity = 0.5      // data size in Mb
		sampleCapacity = 1      // sample size in slots
	}
}

// ----------------------------------------------------------------------------
// Adding HardDrive module for snowflakes so they can get patched.
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[Laboratory]]:NEEDS[FeatureScience] // DangerNoodle; ModuleScienceLab got removed two files above, every part has Laboratory module instead. Replaced ModuleScienceLab with Laboratory
{
	MODULE
	{
		name = HardDrive
	}
}

@PART[ScienceBox]:NEEDS[FeatureScience]
{
	MODULE
	{
		name = HardDrive
	}
}

@PART[kerbalEVA*]:HAS[@MODULE[ModuleTripLogger]]:NEEDS[FeatureScience]
{
	MODULE
	{
		name = HardDrive
	}
}

// ----------------------------------------------------------------------------
// Probes Patches
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[HardDrive],#SSS_Tier[1]]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		@dataCapacity = #$@KERBALISM_HDD_SIZES/Tier1/data$
		@sampleCapacity = #$@KERBALISM_HDD_SIZES/Tier1/samples$
	}
}

@PART[*]:HAS[@MODULE[HardDrive],#SSS_Tier[2]]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		@dataCapacity = #$@KERBALISM_HDD_SIZES/Tier2/data$
		@sampleCapacity = #$@KERBALISM_HDD_SIZES/Tier2/samples$
	}
}

@PART[*]:HAS[@MODULE[HardDrive],#SSS_Tier[3]]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		@dataCapacity = #$@KERBALISM_HDD_SIZES/Tier3/data$
		@sampleCapacity = #$@KERBALISM_HDD_SIZES/Tier3/samples$
	}
}

@PART[*]:HAS[@MODULE[HardDrive],#SSS_Tier[4]]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		@dataCapacity = #$@KERBALISM_HDD_SIZES/Tier4/data$
		@sampleCapacity = #$@KERBALISM_HDD_SIZES/Tier4/samples$
	}
}

@PART[*]:HAS[@MODULE[HardDrive],#SSS_Tier[5]]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		@dataCapacity = #$@KERBALISM_HDD_SIZES/Tier5/data$
		@sampleCapacity = #$@KERBALISM_HDD_SIZES/Tier5/samples$
	}
}

@PART[*]:HAS[@MODULE[HardDrive],#SSS_Tier[6]]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		@dataCapacity = #$@KERBALISM_HDD_SIZES/Tier6/data$
		@sampleCapacity = #$@KERBALISM_HDD_SIZES/Tier6/samples$
	}
}

@PART[*]:HAS[@MODULE[HardDrive],#SSS_Tier[7]]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		@dataCapacity = #$@KERBALISM_HDD_SIZES/Tier7/data$
		@sampleCapacity = #$@KERBALISM_HDD_SIZES/Tier7/samples$
	}
}

@PART[*]:HAS[@MODULE[HardDrive],#SSS_Tier[8]]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		@dataCapacity = #$@KERBALISM_HDD_SIZES/Tier8/data$
		@sampleCapacity = #$@KERBALISM_HDD_SIZES/Tier8/samples$
	}
}

@PART[*]:HAS[@MODULE[HardDrive],#SSS_Tier[9]]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		@dataCapacity = #$@KERBALISM_HDD_SIZES/Tier9/data$
		@sampleCapacity = #$@KERBALISM_HDD_SIZES/Tier9/samples$
	}
}

@PART[*]:HAS[@MODULE[HardDrive],#SSS_Tier[>9]]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		@dataCapacity = #$@KERBALISM_HDD_SIZES/TierX/data$
		@sampleCapacity = #$@KERBALISM_HDD_SIZES/TierX/samples$
	}
}
// ----------------------------------------------------------------------------
// Snowflakes. Has to run after ^, to avoid the global sample capacity nuke for probes.
// ----------------------------------------------------------------------------
// ----------------------------------------------------------------------------
// Crewed Parts Samples
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[ModuleCommand],#CrewCapacity[>0],#SSS_Tier[<6]]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		@sampleCapacity = 1
		@dataCapacity *= #$/CrewCapacity$     
		@sampleCapacity *= #$/CrewCapacity$  
	}
}

@PART[*]:HAS[@MODULE[ModuleCommand],#CrewCapacity[>0],#SSS_Tier[6]]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		@sampleCapacity = 2
		@dataCapacity *= #$/CrewCapacity$     
		@sampleCapacity *= #$/CrewCapacity$  
	}
}

@PART[*]:HAS[@MODULE[ModuleCommand],#CrewCapacity[>0],#SSS_Tier[7]]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		@sampleCapacity = 4
		@dataCapacity *= #$/CrewCapacity$     
		@sampleCapacity *= #$/CrewCapacity$  
	}
}

@PART[*]:HAS[@MODULE[ModuleCommand],#CrewCapacity[>0],#SSS_Tier[>7]]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		@sampleCapacity = 6
		@dataCapacity *= #$/CrewCapacity$     
		@sampleCapacity *= #$/CrewCapacity$  
	}
}

@PART[roverBody*]:NEEDS[FeatureScience]:FOR[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		@dataCapacity = #$@KERBALISM_HDD_SIZES/RoveMate/data$
		@sampleCapacity = #$@KERBALISM_HDD_SIZES/RoveMate/samples$
	}
}

// ----------------------------------------------------------------------------
// HDD capacity storage Upgrades.
// ----------------------------------------------------------------------------

// Applies upgrades to relevant parts based on their initial drive size.
@PART[*]:HAS[@MODULE[HardDrive]:HAS[#dataCapacity[>2],~experiment_id]]:NEEDS[FeatureScience]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		%UPGRADES
		{
			UPGRADE
			{
				name__ = HDD-Upgrade1
				techRequired__ = #$../../../@KERBALISM_HDD_SIZES/Upgrades/DATA_CAPACITY_MULTIPLIERS/FirstUpgradeTech$
				dataCapacity = #$../../#dataCapacity$
				@dataCapacity *= #$../../../@KERBALISM_HDD_SIZES/Upgrades/DATA_CAPACITY_MULTIPLIERS/FirstUpgrade$
			}
		}
	}
}

@PART[*]:HAS[@MODULE[HardDrive]:HAS[#dataCapacity[>16],~experiment_id]]:NEEDS[FeatureScience]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		%UPGRADES
		{
			UPGRADE
			{
				name__ = HDD-Upgrade2
				techRequired__ = #$../../../@KERBALISM_HDD_SIZES/Upgrades/DATA_CAPACITY_MULTIPLIERS/SecondUpgradeTech$
				dataCapacity = #$../../#dataCapacity$
				@dataCapacity *= #$../../../@KERBALISM_HDD_SIZES/Upgrades/DATA_CAPACITY_MULTIPLIERS/SecondUpgrade$
			}
		}
	}
}

@PART[*]:HAS[@MODULE[HardDrive]:HAS[#dataCapacity[>64],~experiment_id]]:NEEDS[FeatureScience]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		%UPGRADES
		{
			UPGRADE
			{
				name__ = HDD-Upgrade3
				techRequired__ = #$../../../@KERBALISM_HDD_SIZES/Upgrades/DATA_CAPACITY_MULTIPLIERS/ThirdUpgradeTech$
				title = Solid State Drive
				dataCapacity = #$../../#dataCapacity$
				@dataCapacity *= #$../../../@KERBALISM_HDD_SIZES/Upgrades/DATA_CAPACITY_MULTIPLIERS/ThirdUpgrade$
			}
		}
	}
}

@PART[*]:HAS[@MODULE[HardDrive]:HAS[#dataCapacity[>512],~experiment_id]]:NEEDS[FeatureScience]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		%UPGRADES
		{
			UPGRADE
			{
				name__ = HDD-Upgrade4
				techRequired__ = #$../../../@KERBALISM_HDD_SIZES/Upgrades/DATA_CAPACITY_MULTIPLIERS/FourthUpgradeTech$
				title = Quantum Data Drive
				dataCapacity = #$../../#dataCapacity$
				@dataCapacity *= #$../../../@KERBALISM_HDD_SIZES/Upgrades/DATA_CAPACITY_MULTIPLIERS/FourthUpgrade$
			}
		}
	}
}

// ----------------------------------------------------------------------------
// Upgrades
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE[HardDrive]:HAS[#sampleCapacity[>2],~experiment_id]]:NEEDS[FeatureScience]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		%UPGRADES
		{
			UPGRADE
			{
				name__ = SampleCapacity-Upgrade1
				techRequired__ = #$../../../@KERBALISM_HDD_SIZES/Upgrades/SAMPLE_CAPACITY_MULTIPLIERS/FirstUpgradeTech$
				sampleCapacity = #$../../#sampleCapacity$
				@sampleCapacity *= #$../../../@KERBALISM_HDD_SIZES/Upgrades/SAMPLE_CAPACITY_MULTIPLIERS/FirstUpgrade$
			}
		}
	}
}
@PART[*]:HAS[@MODULE[HardDrive]:HAS[#sampleCapacity[>5],~experiment_id]]:NEEDS[FeatureScience]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		%UPGRADES
		{
			UPGRADE
			{
				name__ = SampleCapacity-Upgrade2
				techRequired__ = #$../../../@KERBALISM_HDD_SIZES/Upgrades/SAMPLE_CAPACITY_MULTIPLIERS/SecondUpgradeTech$
				sampleCapacity = #$../../#sampleCapacity$
				@sampleCapacity *= #$../../../@KERBALISM_HDD_SIZES/Upgrades/SAMPLE_CAPACITY_MULTIPLIERS/SecondUpgrade$
			}
		}
	}
}
@PART[*]:HAS[@MODULE[HardDrive]:HAS[#sampleCapacity[>8],~experiment_id]]:NEEDS[FeatureScience]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		%UPGRADES
		{
			UPGRADE
			{
				name__ = SampleCapacity-Upgrade3
				techRequired__ = #$../../../@KERBALISM_HDD_SIZES/Upgrades/SAMPLE_CAPACITY_MULTIPLIERS/ThirdUpgradeTech$
				sampleCapacity = #$../../#sampleCapacity$
				@sampleCapacity *= #$../../../@KERBALISM_HDD_SIZES/Upgrades/SAMPLE_CAPACITY_MULTIPLIERS/ThirdUpgrade$
			}
		}
	}
}
// ----------------------------------------------------------------------------
// Removing EVA Drive upgrades (they cannot work due to how stock handles the upgrades)
// They're harmless, but simply avoiding unnecessary upgrade spam.
// ----------------------------------------------------------------------------
@PART[kerbalEVA*]:HAS[@MODULE[ModuleTripLogger]]:NEEDS[FeatureScience]:AFTER[zzzKerbalismDefault]
{
	@MODULE[HardDrive]
	{
		!UPGRADES,*		{}
	}
}
// ----------------------------------------------------------------------------
// Internal(Private) Drive upgrades
// these have to be done by hand to avoid patching groups. (labs mainly)
// ----------------------------------------------------------------------------
// Goo
@PART[*]:HAS[@MODULE[Experiment]:HAS[#experiment_id[mysteryGoo]],!MODULE[Laboratory]]:NEEDS[FeatureScience]:AFTER[zzzKerbalismDefault]
{
	MODULE
	{
		name = HardDrive
		experiment_id = mysteryGoo
		dataCapacity = 0
		sampleCapacity = #$@KERBALISM_HDD_SIZES/PRIVATE_DRIVES/MysteryGoo/samples$

		UPGRADES
		{
			UPGRADE
			{
				name__ = Goo-Storage-Upgrade
				techRequired__ = #$../../../@KERBALISM_HDD_SIZES/PRIVATE_DRIVES/MysteryGoo/UpgradeTech$
				sampleCapacity = #$../../#sampleCapacity$
				@sampleCapacity *= #$../../../@KERBALISM_HDD_SIZES/PRIVATE_DRIVES/MysteryGoo/SampleReservoirUpgrade$
			}
		}
	}
}

// Materials Bay
@PART[*]:HAS[@MODULE[Experiment]:HAS[#experiment_id[mobileMaterialsLab]],!MODULE[Laboratory]]:NEEDS[FeatureScience]:AFTER[zzzKerbalismDefault]
{
	MODULE
	{
		name = HardDrive
		experiment_id = mobileMaterialsLab
		dataCapacity = 0
		sampleCapacity = #$@KERBALISM_HDD_SIZES/PRIVATE_DRIVES/MaterialsBay/samples$

		UPGRADES
		{
			UPGRADE
			{
				name__ = MatBay-Storage-Upgrade
				techRequired__ = #$../../../@KERBALISM_HDD_SIZES/PRIVATE_DRIVES/MaterialsBay/UpgradeTech$
				sampleCapacity = #$../../#sampleCapacity$
				@sampleCapacity *= #$../../../@KERBALISM_HDD_SIZES/PRIVATE_DRIVES/MaterialsBay/SampleReservoirUpgrade$
			}
		}
	}
}


//=========================================================
// Hard Drive Upgrades
//=========================================================

//Data capacity upgrades
PARTUPGRADE:NEEDS[FeatureScience]
{
  name = HDD-Upgrade1
  partIcon = ScienceBox
  title = HDD Capacity Upgrade
  manufacturer = Spacegate Technology
  description = Engineers figured that if they add another platter to the drive, they can double the capacity!
}
@PARTUPGRADE[HDD-Upgrade1]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
  %techRequired = #$@KERBALISM_HDD_SIZES/Upgrades/DATA_CAPACITY_MULTIPLIERS/FirstUpgradeTech$
  %entryCost = #$@KERBALISM_HDD_SIZES/Upgrades/DATA_CAPACITY_MULTIPLIERS/FirstUpgradeEntryCost$
}
PARTUPGRADE:NEEDS[FeatureScience]
{
  name = HDD-Upgrade2
  partIcon = ScienceBox
  title = HDD Capacity Upgrade
  manufacturer = Spacegate Technology
  description = An increase in platter density equals an increase in capacity!
}
@PARTUPGRADE[HDD-Upgrade2]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
  %techRequired = #$@KERBALISM_HDD_SIZES/Upgrades/DATA_CAPACITY_MULTIPLIERS/SecondUpgradeTech$
  %entryCost = #$@KERBALISM_HDD_SIZES/Upgrades/DATA_CAPACITY_MULTIPLIERS/SecondUpgradeEntryCost$
}
PARTUPGRADE:NEEDS[FeatureScience]
{
  name = HDD-Upgrade3
  partIcon = ScienceBox
  title = HDD Capacity Upgrade
  manufacturer = Spacegate Technology
  description = Converts all the old dusty Hard Drives to all new and shiny Solid State Drives!
}
@PARTUPGRADE[HDD-Upgrade3]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
  %techRequired = #$@KERBALISM_HDD_SIZES/Upgrades/DATA_CAPACITY_MULTIPLIERS/ThirdUpgradeTech$
  %entryCost = #$@KERBALISM_HDD_SIZES/Upgrades/DATA_CAPACITY_MULTIPLIERS/ThirdUpgradeEntryCost$
}
PARTUPGRADE:NEEDS[FeatureScience]
{
  name = HDD-Upgrade4
  partIcon = ScienceBox
  title = HDD Capacity Upgrade
  manufacturer = Spacegate Technology
  description = Quantum physics shenenigans! It just works. Don't ask how.
}
@PARTUPGRADE[HDD-Upgrade4]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
  %techRequired = #$@KERBALISM_HDD_SIZES/Upgrades/DATA_CAPACITY_MULTIPLIERS/FourthUpgradeTech$
  %entryCost = #$@KERBALISM_HDD_SIZES/Upgrades/DATA_CAPACITY_MULTIPLIERS/FourthUpgradeEntryCost$
}

//Sample capacity upgrades
PARTUPGRADE:NEEDS[FeatureScience]
{
  name = SampleCapacity-Upgrade1
  partIcon = ScienceBox
  title = Sample Storage Capacity Upgrade
  manufacturer = Spacegate Technology
  description = Increase the total amount of sample storage
}
@PARTUPGRADE[SampleCapacity-Upgrade1]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
  %techRequired = #$@KERBALISM_HDD_SIZES/Upgrades/SAMPLE_CAPACITY_MULTIPLIERS/FirstUpgradeTech$
  %entryCost = #$@KERBALISM_HDD_SIZES/Upgrades/SAMPLE_CAPACITY_MULTIPLIERS/FirstUpgradeEntryCost$
}
PARTUPGRADE:NEEDS[FeatureScience]
{
  name = SampleCapacity-Upgrade2
  partIcon = ScienceBox
  title = Sample Storage Capacity Upgrade
  manufacturer = Spacegate Technology
  description = Increase the total amount of sample storage
}
@PARTUPGRADE[SampleCapacity-Upgrade2]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
  %techRequired = #$@KERBALISM_HDD_SIZES/Upgrades/SAMPLE_CAPACITY_MULTIPLIERS/SecondUpgradeTech$
  %entryCost = #$@KERBALISM_HDD_SIZES/Upgrades/SAMPLE_CAPACITY_MULTIPLIERS/SecondUpgradeEntryCost$
}
PARTUPGRADE:NEEDS[FeatureScience]
{
  name = SampleCapacity-Upgrade3
  partIcon = ScienceBox
  title = Sample Storage Capacity Upgrade
  manufacturer = Spacegate Technology
  description = Increase the total amount of sample storage
}
@PARTUPGRADE[SampleCapacity-Upgrade3]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
  %techRequired = #$@KERBALISM_HDD_SIZES/Upgrades/SAMPLE_CAPACITY_MULTIPLIERS/ThirdUpgradeTech$
  %entryCost = #$@KERBALISM_HDD_SIZES/Upgrades/SAMPLE_CAPACITY_MULTIPLIERS/ThirdUpgradeEntryCost$
}