// ============================================================================
// Mobile Materials Bay
// ============================================================================

// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_EXPERIMENT_VALUES:NEEDS[FeatureScience]
{
	%SPACELINES
	{
        mobileMaterialsLab
		{
			ECCost = 5	
			size = 2049				
			value = 24								
			duration = 1800 
			SetupMass =
			SetupCost =
			UnlockTech = 
			requirements =
			ResourceRates =
			CrewRequirement = Scientist
		}
    }
}

// ----------------------------------------------------------------------------
// Kerbalism Configs
// ----------------------------------------------------------------------------

@EXPERIMENT_DEFINITION:HAS[#id[mobileMaterialsLab]]:NEEDS[FeatureScience]:FOR[SkyhawkKerbalism]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/mobileMaterialsLab/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/mobileMaterialsLab/size$
	@dataScale /= #$baseValue$

	%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/mobileMaterialsLab/duration$

	KERBALISM_EXPERIMENT
	{
		SampleMass = 0.032
		Situation = SrfLanded@Biomes
		Situation = SrfSplashed@Biomes
		Situation = FlyingLow
		Situation = FlyingHigh
		Situation = InSpaceLow
		Situation = InSpaceHigh
	}
}

// Tagging parts
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[mobileMaterialsLab]]]:NEEDS[FeatureScience] {
    %Tag_Spacelines_MobileMaterialsBay = True
}

// Experiment module
@PART[*]:HAS[#Tag_Spacelines_MobileMaterialsBay[True]]:NEEDS[FeatureScience] {
    MODULE
	{
		name = Experiment
		experiment_id = mobileMaterialsLab
	}
}

// Setting Experiment Values
@PART[*]:HAS[#Tag_Spacelines_MobileMaterialsBay[True]]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[mobileMaterialsLab]] {
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/mobileMaterialsLab/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/mobileMaterialsLab/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/mobileMaterialsLab/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/mobileMaterialsLab/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/mobileMaterialsLab/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/mobileMaterialsLab/ResourceRates$
        %sample_amount = 1
		%crew_prepare = Scientist

		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/mobileMaterialsLab/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/mobileMaterialsLab/size$
	}
}

// Animations
@PART[*]:HAS[#Tag_Spacelines_MobileMaterialsBay[True],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

// Deleting old experiment module
@PART[*]:HAS[@MODULE:HAS[#Tag_Spacelines_MobileMaterialsBay[True]]]:NEEDS[FeatureScience]
{
	!MODULE:HAS[#experimentID[mobileMaterialsLab],~name[Experiment]]	{}
}


// Materials Bay internal storage upgrade.
PARTUPGRADE:NEEDS[FeatureScience]
{
  name = MatBay-Storage-Upgrade
  partIcon = science_module
  title = Materials Bay Sample Capacity Upgrade
  manufacturer = Spacegate Technology
  description = Increase the total amount of sample storage for the Materials Bay
}
@PARTUPGRADE[MatBay-Storage-Upgrade]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
  %techRequired = #$@KERBALISM_HDD_SIZES/PRIVATE_DRIVES/MaterialsBay/UpgradeTech$
  %entryCost = #$@KERBALISM_HDD_SIZES/PRIVATE_DRIVES/MaterialsBay/UpgradeEntryCost$
}