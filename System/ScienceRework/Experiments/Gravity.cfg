// ============================================================================
// Gravity Experiments
// ============================================================================
// Modules being replaced:
// -----------------------
// + Geodesy (Knes)
// ----------------------------------------------------------------------------
// Stock: gravityScan
// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_EXPERIMENT_VALUES:NEEDS[FeatureScience]
{
	%SPACELINES
	{
		Spacelines_gravityScan
		{
			ECCost = 0.041
			size = 26014
			value = 16								// nerfed value, (22->16)
			duration = 1959086				//first properly long experiment, takes 90+ days to complete. Situations unchanged, biomes = landed/splashed only.
			requirements = OrbitMinInclination:50,OrbitMaxInclination:130
			ResourceRates =
		}

		Spacelines_OrbitalPerturbations
		{
			ECCost = 0
			size = 75000
			value = 250			
			SetupMass =
			SetupCost =			
			duration = 43200000 // 500 days
			UnlockTech = 
			requirements = OrbitMinInclination:50,OrbitMaxInclination:130,TrackingStationLevelMin:2,OrbitMaxEccentricity:0.04
			ResourceRates =
			CrewRequirement = 
		}
	}
}

// ----------------------------------------------------------------------------
// Kerbalism Config
// ----------------------------------------------------------------------------

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_gravityScan]]:NEEDS[FeatureScience]:FOR[zzzKerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_gravityScan/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_gravityScan/size$
	@dataScale /= #$baseValue$
  
  	KERBALISM_EXPERIMENT
	{
		Situation = Surface@Biomes
		Situation = InSpaceLow
		Situation = InSpaceHigh
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_OrbitalPerturbations]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_OrbitalPerturbations/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_OrbitalPerturbations/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
	{
		Situation = InSpaceLow@Biomes
		BodyAllowed = HomeBody
	}
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------

// Gravity Scan
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[gravityScan]]]:NEEDS[FeatureScience]
{
	%Tag_Spacelines_gravityScan = True
}

// Creating Experiment modules
@PART[*]:HAS[#Tag_Spacelines_OrbitalPerturbations[True]]:NEEDS[FeatureScience] {
	MODULE
    {
        name = Experiment
        experiment_id = Spacelines_OrbitalPerturbations
    }
}

// Setting Experiment Values

@PART[*]:HAS[#Tag_Spacelines_OrbitalPerturbations[True]]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_OrbitalPerturbations]] {
		%ec_rate = 0 // NO EC NEEDED FOR PASSIVE ONES
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_OrbitalPerturbations/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_OrbitalPerturbations/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_OrbitalPerturbations/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_OrbitalPerturbations/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_OrbitalPerturbations/ResourceRates$
		
		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_OrbitalPerturbations/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_OrbitalPerturbations/size$
    }
}

@PART[*]:HAS[#Tag_Spacelines_gravityScan[True]]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_gravityScan]] {
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_gravityScan/ECCost$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_gravityScan/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_gravityScan/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_gravityScan/ResourceRates$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_gravityScan/size$
    }
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------
@PART[*]:HAS[#Tag_Spacelines_OrbitalPerturbations[True],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

@PART[*]:HAS[#Tag_Spacelines_gravityScan[True],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

// Sensors
@PART[*]:HAS[#Tag_Spacelines_gravityScan[True]]:NEEDS[FeatureScience]
{
	!MODULE[ModuleEnviroSensor] {}
	MODULE
	{
		name = Sensor
		type = gravioli
	}
}
