// ============================================================================
// Surface Sample Experiments
// ============================================================================

// ----------------------------------------------------------------------------
// STOCK surfaceSample considered to be part of these
// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_GROUP_SETTINGS:NEEDS[FeatureScience]
{
	%SPACELINES
	{
		
        Spacelines_CoreSampleDrill
		{
			ECCost = 5	
			size = 512 						
			value = 34								
			duration = 10 
			SetupMass =
			SetupCost =
			UnlockTech = 
			requirements =
			ResourceRates =
			CrewRequirement =
		}
		Spacelines_XrayDiffractionScan
		{
			ECCost = 4
			size = 13				
			value = 10
			duration = 30
			SetupMass =
			SetupCost =
			UnlockTech = 
			requirements =
			ResourceRates =
			CrewRequirement =
		}
        Spacelines_LaserSurfaceScan
        {
            ECCost = 10	
			size = 26						
			value = 13								
			duration = 10 
			SetupMass =
			SetupCost =
			UnlockTech = 
			requirements =
			ResourceRates =
			CrewRequirement =
        }
    }
}

// ----------------------------------------------------------------------------
// Kerbalism Config
// ----------------------------------------------------------------------------

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_CoreSampleDrill]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/value$
	@dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
	{
		SampleMass = 0.025
		Situation = Surface@Biomes
        IncludeExperiment = 
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_XrayDiffractionScan]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayDiffractionScan/value$
	@dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayDiffractionScan/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
	{
		Situation = Surface@Biomes
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_LaserSurfaceScan]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_LaserSurfaceScan/value$
	@dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_LaserSurfaceScan/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
	{
		Situation = Surface@Biomes
	}
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------

@PART[*]:HAS[#Tag_Spacelines_SurfaceSample[True]]:NEEDS[FeatureScience] {
 	MODULE
	{
		name = Experiment
		experiment_id = surfaceSample
	}
} // Reconfigured in Stock Experiments file

@PART[*]:HAS[#Tag_Spacelines_CoreSampleDrill[True]]:NEEDS[FeatureScience] {
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_CoreSampleDrill
	}
}

@PART[*]:HAS[#Tag_Spacelines_XrayDiffractionScan[True]]:NEEDS[FeatureScience] {
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_XrayDiffractionScan
	}
}

@PART[*]:HAS[#Tag_Spacelines_LaserSurfaceScan[True]]:NEEDS[FeatureScience] {
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_LaserSurfaceScan
	}
}

// ----------------------------------------------------------------------------
// Reconfiguration
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[Experiment]:HAS[#experiment_id[Spacelines_CoreSampleDrill]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_CoreSampleDrill]] {
        %ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/ResourceRates$
		%sample_collecting = True
		
		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/size$
    }
}

@PART[*]:HAS[@MODULE[Experiment]:HAS[#experiment_id[Spacelines_XrayDiffractionScan]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_XrayDiffractionScan]] {
        %ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayDiffractionScan/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayDiffractionScan/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayDiffractionScan/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayDiffractionScan/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayDiffractionScan/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayDiffractionScan/ResourceRates$
		
		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayDiffractionScan/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_XrayDiffractionScan/size$
    }
}

@PART[*]:HAS[@MODULE[Experiment]:HAS[#experiment_id[Spacelines_CoreSampleDrill]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_CoreSampleDrill]] {
        %ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/ResourceRates$
		
		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CoreSampleDrill/size$
    }
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------
// If there's an experiment with a DMOS module take their animations and insert them
// into the previously created Experiment module
// ----------------------------------------------------------------------------

@PART[*]:HAS[#Tag_Spacelines_CoreSampleDrill[True],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

@PART[*]:HAS[#Tag_Spacelines_XrayDiffractionScan[True],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

@PART[*]:HAS[#Tag_Spacelines_LaserSurfaceScan[True],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

// ----------------------------------------------------------------------------
// Cleaning replaced experiments
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_soilScoop]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_soilScoop]] {}
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_drill]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_drill]] {}
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_XRayDiffract]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_XRayDiffract]] {}
}
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[dmlaserblastscan]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[dmlaserblastscan]] {}
}
