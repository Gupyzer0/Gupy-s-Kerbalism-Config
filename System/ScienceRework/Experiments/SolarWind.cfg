// ============================================================================
// Solar Wind
// ============================================================================
// Modules being replaced:
// -----------------------
// + bd_solarwind
// + dmSolarParticles
// ----------------------------------------------------------------------------

// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_EXPERIMENT_VALUES:NEEDS[FeatureScience]
{
	%SPACELINES
	{
        Spacelines_SolarWind
        {
            ECCost = 0.05	
            size = 11000
            value = 300
            SetupMass =
            SetupCost =			
            duration = 31536000 // 1y
            UnlockTech = 
            requirements =
            ResourceRates =
            CrewRequirement =
        }
    }
}

// ----------------------------------------------------------------------------
// Kerbalism Config
// ----------------------------------------------------------------------------

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_SolarWind]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
    @baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWind/value$
	dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWind/size$
	@dataScale /= #$baseValue$

    KERBALISM_EXPERIMENT 
	{
		VirtualBiome = NoBiome
        VirtualBiome = InnerBelt
        VirtualBiome = OuterBelt
        VirtualBiome = Magnetosphere
        VirtualBiome = Storm
        VirtualBiome = Interstellar

        Situation = Space@VirtualBiomes
	}
}
// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------

// Experiment module
@PART[*]:HAS[#Tag_Spacelines_SolarWind[True]]:NEEDS[FeatureScience] {
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_SolarWind
	}
}

// Setting Experiment Values
@PART[*]:HAS[#Tag_Spacelines_SolarWind[True]]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_SolarWind]] {
		%ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWind/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWind/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWind/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWind/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWind/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWind/ResourceRates$

		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWind/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_SolarWind/size$
	}
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[#Tag_Spacelines_SolarWind[True],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

// ----------------------------------------------------------------------------
// Cleaning old science modules
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_solarwind]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
  !MODULE[*ModuleScience*]:HAS[#experimentID[bd_solarwind]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[dmSolarParticles]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
  !MODULE[*ModuleScience*]:HAS[#experimentID[dmSolarParticles]] {}
}

