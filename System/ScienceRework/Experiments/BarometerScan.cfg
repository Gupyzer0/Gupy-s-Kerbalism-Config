// ============================================================================
// Barometer Scan
// ============================================================================

@KERBALISM_EXPERIMENT_VALUES:NEEDS[FeatureScience]
{
	%SPACELINES
	{
        Spacelines_BarometerScan
		{
			ECCost = 0.05
			size = 3.5	  					  // you have to "steram" your first barometer scans
			value = 9									// nerfed value (12->9), changed situations to atmo/landed/splashed, biome masks landed/splashed/flying low, made it require atmosphere in all cases. (there's no pressure if there's no atmosphere, i'm sorry)
			duration = 916						//15 minutes+
			requirements =
			ResourceRates =
		}
    }
}

// ----------------------------------------------------------------------------
// Kerbalism Config
// ----------------------------------------------------------------------------

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_BarometerScan]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_BarometerScan/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_BarometerScan/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT //Not sure if this should be biome based or hemisphere based...
	{
		BodyAllowed = Atmospheric
		
		Situation = Surface@Biomes
		Situation = FlyingLow@Biomes
		Situation = FlyingHigh
	}
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[barometerScan]]]:NEEDS[FeatureScience] {
    %Tag_Spacelines_BarometerScan = True
}

// Experiment module
@PART[*]:HAS[#Tag_Spacelines_BarometerScan[True]]:NEEDS[FeatureScience] {
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_BarometerScan
	}
}

@PART[*]:HAS[#Tag_Spacelines_BarometerScan[True]]:NEEDS[FeatureScience] {
    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_BarometerScan]] {
		%ec_rate = 0 // NO EC NEEDED FOR PASSIVE ONES
		//%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_BarometerScan/CrewRequirement$
		//%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_BarometerScan/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_BarometerScan/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_BarometerScan/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_BarometerScan/ResourceRates$
		
		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_BarometerScan/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_BarometerScan/size$
    }
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------
@PART[*]:HAS[#Tag_Spacelines_BarometerScan[True],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

// ----------------------------------------------------------------------------
// Sensor
// ----------------------------------------------------------------------------
@PART[*]:HAS[!MODULE[Sensor]:HAS[#type[pressure]],@MODULE[Experiment]:HAS[#experiment_id[Spacelines_BarometerScan]]]:NEEDS[FeatureScience]:FOR[zzzKerbalismDefault]
{
	!MODULE[ModuleEnviroSensor] {}
	MODULE
	{
		name = Sensor
		type = pressure
	}
}