// ============================================================================
// Imaging Spectrometry
// ============================================================================

// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_EXPERIMENT_VALUES:NEEDS[FeatureScience]
{
	%SPACELINES
	{
		// Spacelines_MassSpectrometry{
		// 	ECCost = 0.05
		// 	size = 3						
		// 	value = 7								
		// 	duration = 7200 				
		// 	requirements = 
		// 	ResourceRates =
		// 	CrewRequirement = 
		// }
		Spacelines_MassSpectrometry1
        {
            ECCost = 0.002
			size = 0.001
			value = 8
			duration = 7200 // 2 hours
			requirements = 
			ResourceRates =
			CrewRequirement = 
            SetupCost = 
            mass = 
            tech = 
        }
		Spacelines_MassSpectrometry2
        {
            ECCost = 0.005
			size = 0.01
			value = 12
			duration = 1209600 // 14 days
			requirements = OrbitMinEccentricity:0.1
			ResourceRates =
			CrewRequirement = 
            SetupCost = 
            mass = 
            tech = science3
        }
		Spacelines_MassSpectrometry3
        {
            ECCost = 0.01
			size = 0.1
			value = 20
			duration = 7862400 // 3 months
			requirements = OrbitMinEccentricity:0.1
			ResourceRates =
			CrewRequirement = 
            SetupCost = 
            mass = 
            tech = science7
        }
		Spacelines_MassSpectrometry4
        {
            ECCost = 0.06
			size = 884.52
			value = 30
			duration = 7862400 // 3 months
			requirements =
			ResourceRates =
			CrewRequirement = 
            SetupCost = 
            mass = 
            tech = science8
        }
	}
}

// ----------------------------------------------------------------------------
// Science Definitions 
// ----------------------------------------------------------------------------

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_MassSpectrometry1]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry1/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry1/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
    {
		SampleMass = 0
		IncludeExperiment = 
    }
}

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_MassSpectrometry2]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry2/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry2/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
    {
		SampleMass = 0
		IncludeExperiment = Spacelines_MassSpectrometry1
    }
}

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_MassSpectrometry3]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry3/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry3/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
    {
		SampleMass = 0
		IncludeExperiment = Spacelines_MassSpectrometry2
    }
}

@EXPERIMENT_DEFINITION:HAS[#id[Spacelines_MassSpectrometry4]]:NEEDS[FeatureScience]:FOR[KerbalismDefault]
{
	@baseValue = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry4/value$
	@dataScale = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry4/size$
	@dataScale /= #$baseValue$

	KERBALISM_EXPERIMENT
    {
		SampleMass = 0
		IncludeExperiment = Spacelines_MassSpectrometry3
    }
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------

// Experiment module
@PART[*]:HAS[#Tag_massSpectrometry[True]]:NEEDS[FeatureScience] {
    MODULE
	{
		name = Experiment
		experiment_id = Spacelines_MassSpectrometry
	}
}

// Configure Module
@PART[*]:HAS[#Tag_massSpectrometry[True]]:NEEDS[FeatureScience]
{
    MODULE
    {
        name = Experiment
        experiment_id = Spacelines_MassSpectrometry1
    }

    MODULE
    {
        name = Experiment
        experiment_id = Spacelines_MassSpectrometry2
    }

    MODULE
    {
        name = Experiment
        experiment_id = Spacelines_MassSpectrometry3
    }

	MODULE
    {
        name = Experiment
        experiment_id = Spacelines_MassSpectrometry4
    }

    MODULE
	{
		name = Configure
		title = Mass Spectrometry Experiments
		slots = 1

        SETUP
        {
            name = MassSpectrometry1
            desc = Mass Spectrometer

            MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_MassSpectrometry1
			}
        }

        SETUP
        {
            name = MassSpectrometry2
            desc = MIMS on Explorer 31

            MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_MassSpectrometry2
			}
        }

		SETUP
        {
            name = MassSpectrometry3
            desc = Quadropole mass spectrometer on OVI-15, Viking and Pioneer Venus Orbiter

            MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_MassSpectrometry3
			}
        }

		SETUP
        {
            name = MassSpectrometry4
            desc = Gas Chromatograph-Mass Spectrometer on Viking and Cassini

            MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_MassSpectrometry4
			}
        }
    }
}
// Experiment Values
@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Mass?Spectrometry?Experiments]]]:NEEDS[FeatureScience]
{
	@MODULE[Configure]:HAS[#title[Mass?Spectrometry?Experiments]]
	{
		@SETUP:HAS[#name[MassSpectrometry1]]
		{
            cost = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry1/SetupCost
            mass = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry1/SetupMass
            tech = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry1/tech
        }
        @SETUP:HAS[#name[MassSpectrometry2]]
		{
            cost = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry2/SetupCost
            mass = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry2/SetupMass
            tech = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry2/tech
        }
		@SETUP:HAS[#name[MassSpectrometry3]]
		{
            cost = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry3/SetupCost
            mass = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry3/SetupMass
            tech = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry3/tech
        }
		@SETUP:HAS[#name[MassSpectrometry4]]
		{
            cost = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry4/SetupCost
            mass = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry4/SetupMass
            tech = #$../../@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry4/tech
        }
    }

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_MassSpectrometry1]]
	{
        %ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry1/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry1/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry1/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry1/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry1/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry1/ResourceRates$

		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry1/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry1/size$
    }

    @MODULE[Experiment]:HAS[#experiment_id[Spacelines_MassSpectrometry2]]
	{
        %ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry2/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry2/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry2/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry2/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry2/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry2/ResourceRates$

		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry2/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry2/size$
    }

	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_MassSpectrometry3]]
	{
        %ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry3/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry3/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry3/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry3/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry3/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry3/ResourceRates$

		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry3/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry3/size$
    }

	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_MassSpectrometry4]]
	{
        %ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry4/ECCost$
		%crew_operate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry4/CrewRequirement$
		%requires = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry4/requirements$
		%data_rate = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry4/size$
		@data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry4/duration$
		%resources = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry4/ResourceRates$

		%experimentLength = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry4/duration$
		%experimentSize = #$@KERBALISM_EXPERIMENT_VALUES/SPACELINES/Spacelines_MassSpectrometry4/size$
    }
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------

@PART[*]:HAS[#Tag_massSpectrometry[True],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}
