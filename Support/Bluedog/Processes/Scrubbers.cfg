// ==============================================================================
// Add scrubber configuration to tagged parts
// ==============================================================================

// Get tagged parts and add the required Scrubber modules

// US only scrubber
@PART[*]:HAS[#capsuleScrubbers[true],#scrubberCapacity[*],#capsuleOrigin[US]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  MODULE
  {
    name = ProcessController
    resource = _NonRegenScrubber
    title = Non Regen LiOH Scrubber
    toggle = true
    running = true
    capacity = 1.1
    @capacity *= #$/CrewCapacity$
  }
}

@PART[*]:HAS[#capsuleScrubbers[true],#scrubberCapacity[*]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  MODULE
  {
    name = ProcessController
    resource = _Scrubber
    title = LiOH Scrubber
    toggle = true
    running = true
    capacity = #$/scrubberCapacity$
    @capacity *= #$/CrewCapacity$
  }

  MODULE
  {
    name = ProcessController
    resource = _VacScrubber
    title = Vac Scrubber
    toggle = true
    running = true
    capacity = #$/scrubberCapacity$
    @capacity *= #$/CrewCapacity$
  }

  MODULE
  {
    name = ProcessController
    resource = _AdvScrubber
    title = Adv Vac Scrubber
    toggle = true
    running = true
    capacity = #$/scrubberCapacity$
    @capacity *= #$/CrewCapacity$
  }
}

@PART[*]:HAS[#capsuleScrubbers[true],@MODULE[ProcessController]:HAS[#resource[_NonRegenScrubber]]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  @MODULE[Configure]:HAS[#title[Scrubber]]
  {
    SETUP
    {
      name = LiOH scrubber (2d)
      desc = A <b>Lithium Hydroxide</b> scrubber that sequesters <b>CarbonDioxide</b> from the internal atmosphere. <b>WARNING: Only lasts 2 days!</b> Research next life support nodes to unlock better options.
      tech = crewSurvivability
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _NonRegenScrubber
      }
    }
  }
}

@PART[*]:HAS[#capsuleScrubbers[true],@MODULE[ProcessController]:HAS[#resource[_Scrubber]]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  @MODULE[Configure]:HAS[#title[Scrubber]]
  {
    SETUP
    {
      name = LiOH Scrubber
      desc = A Lithium Hydroxide scrubber that sequesters <b>CarbonDioxide</b> from the internal atmosphere. Its operational life <b>can</b> be increased by adding additional LiOH tanks.
      tech = earlyLifeSupport
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _Scrubber
      }
    }
  }
}

@PART[*]:HAS[#capsuleScrubbers[true],@MODULE[ProcessController]:HAS[#resource[_VacScrubber]]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  @MODULE[Configure]:HAS[#title[Scrubber]]
  {
    SETUP
    {
      name = Vacuum Scrubber
      desc = A dual-bed vacuum-exposing regenerative scrubber that sequesters <b>CarbonDioxide</b> from the internal atmosphere. Can work indefinitely.
      tech = basicLifeSupport
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _VacScrubber
      }
    }
  }
}

@PART[*]:HAS[#capsuleScrubbers[true],@MODULE[ProcessController]:HAS[#resource[_AdvScrubber]]]:NEEDS[ProfileRealismOverhaul]:FOR[zzzKerbalism]
{
  @MODULE[Configure]:HAS[#title[Scrubber]]
  {
    SETUP
    {
      name = Advanced Vacuum Scrubber
      desc = A dual-bed vacuum-exposing regenerative scrubber that sequesters <b>CarbonDioxide</b> from the internal atmosphere. Can work indefinitely. Tip: use Water Electrolysis to produce O2.
      tech = improvedLifeSupport
            
      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _AdvScrubber
      }
    }
  }
}